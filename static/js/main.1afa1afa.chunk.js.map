{"version":3,"sources":["boxed_expression_editor/api/BuiltinAggregation.ts","boxed_expression_editor/api/ContextEntry.ts","boxed_expression_editor/api/DataType.ts","boxed_expression_editor/api/HitPolicy.ts","boxed_expression_editor/api/LogicType.ts","boxed_expression_editor/i18n/locales/en.ts","boxed_expression_editor/i18n/setup.ts","boxed_expression_editor/index.tsx","index.tsx","boxed_expression_editor/api/index.ts","boxed_expression_editor/i18n/index.ts","boxed_expression_editor/api/Table.ts","boxed_expression_editor/components/PopoverMenu/PopoverMenu.tsx","boxed_expression_editor/context/BoxedExpressionGlobalContext.tsx","boxed_expression_editor/components/EditExpressionMenu/EditExpressionMenu.tsx","boxed_expression_editor/components/Resizer/dom/Cell.ts","boxed_expression_editor/components/Resizer/dom/DOMSession.ts","boxed_expression_editor/components/Resizer/dom/ResizerSupervisorDOM.ts","boxed_expression_editor/components/Resizer/Resizer.tsx","boxed_expression_editor/components/Resizer/ResizerSupervisor.tsx","boxed_expression_editor/components/LiteralExpression/LiteralExpression.tsx","boxed_expression_editor/components/Table/TableBody.tsx","boxed_expression_editor/components/Table/TableHandlerMenu.tsx","boxed_expression_editor/components/Table/TableHandler.tsx","boxed_expression_editor/components/Table/TableHeader.tsx","boxed_expression_editor/components/Table/Table.tsx","boxed_expression_editor/components/Table/EditableCell.tsx","boxed_expression_editor/components/RelationExpression/RelationExpression.tsx","boxed_expression_editor/components/ContextExpression/ContextEntryExpression.tsx","boxed_expression_editor/components/ContextExpression/ContextEntryExpressionCell.tsx","boxed_expression_editor/components/ContextExpression/ContextEntryInfo.tsx","boxed_expression_editor/components/ContextExpression/ContextEntryInfoCell.tsx","boxed_expression_editor/components/ContextExpression/ContextExpression.tsx","boxed_expression_editor/components/DecisionTableExpression/DecisionTableExpression.tsx","boxed_expression_editor/components/ListExpression/ListExpression.tsx","boxed_expression_editor/components/InvocationExpression/InvocationExpression.tsx","boxed_expression_editor/components/LogicTypeSelector/LogicTypeSelector.tsx","boxed_expression_editor/hooks/Hooks.ts","boxed_expression_editor/components/ExpressionContainer/ExpressionContainer.tsx","boxed_expression_editor/components/BoxedExpressionEditor/BoxedExpressionEditor.tsx"],"names":["BuiltinAggregation","DEFAULT_ENTRY_INFO_MIN_WIDTH","DEFAULT_ENTRY_EXPRESSION_MIN_WIDTH","getHandlerConfiguration","i18n","groupName","group","items","name","rowOperations","insertAbove","type","TableOperation","RowInsertAbove","insertBelow","RowInsertBelow","delete","RowDelete","clear","RowClear","generateNextAvailableEntryName","contextEntries","namePrefix","lastIndex","length","candidateName","entryWithCandidateName","_","entryInfo","getEntryKey","row","original","resetEntry","entryExpression","uid","DataType","HitPolicy","LogicType","en","en_common","choose","columnOperations","insertLeft","insertRight","columns","context","contextEntry","dataType","decisionTable","editContextEntry","editExpression","editParameter","editRelation","enterFunction","function","invocation","list","literalExpression","parameters","relation","rows","selectExpression","selectLogicType","boxedExpressionEditorI18nDefaults","locale","dictionary","boxedExpressionEditorDictionaries","Map","BoxedExpressionEditorI18nContext","React","useBoxedExpressionEditorI18n","useContext","window","renderBoxedExpressionEditor","selector","definition","ReactDOM","expressionDefinition","selectedExpression","document","getElementById","App","logicType","isHeadless","width","result","entryExpressionWidth","useState","updatedExpression","setUpdatedExpression","beeApi","resetExpressionDefinition","broadcastLiteralExpressionDefinition","broadcastRelationExpressionDefinition","broadcastContextExpressionDefinition","broadcastListExpressionDefinition","broadcastInvocationExpressionDefinition","className","JSON","stringify","TableHeaderVisibility","PopoverMenu","children","arrowPlacement","body","title","appendTo","hasAutoWidth","Popover","data-ouia-component-id","position","distance","id","reference","headerContent","bodyContent","BoxedExpressionGlobalContext","EXPRESSION_NAME","EditExpressionMenu","nameField","dataTypeField","selectedDataType","Undefined","selectedExpressionName","onExpressionUpdate","globalContext","boxedExpressionEditorRef","current","undefined","dataTypeSelectOpen","setDataTypeSelectOpen","setDataType","expressionName","setExpressionName","useEffect","onExpressionNameChange","useCallback","event","target","value","onDataTypeSelect","selection","getDataTypes","Object","values","key","SelectOption","onDataTypeFilter","e","input","RegExp","exception","filter","child","test","props","onDataTypeSelectToggle","isOpen","onChange","onBlur","placeholder","Select","ouiaId","variant","SelectVariant","typeahead","typeAheadAriaLabel","onToggle","onSelect","onFilter","selections","hasInlineFilter","inlineFilterPlaceholderText","Cell","element","depth","lastColumn","rect","this","slice","call","classList","c","match","getBoundingClientRect","parent","closest","isLast","lastChild","cellWidth","dispatchEvent","CustomEvent","getId","detail","style","setWidth","fetchChildWidth","PADDING","isLastColumn","parentRect","cellRect","right","x","thead","querySelector","DEFAULT_WIDTH","DOMSession","cells","buildCells","fetchCellElements","forEach","cellElement","buildCell","htmlElement","depthLevel","exitingElement","find","cell","map","push","htmlElements","querySelectorAll","CELL_CSS_SELCTOR","applyDOMSupervisor","fn","latestCall","setTimeout","clearInterval","throttling","SupervisorExecution","execute","domSession","refreshWidthAsParent","refreshWidthAsLastColumn","getCells","p1","performance","now","index","sort","c1","c2","updateSize","updateLastColumns","p2","console","log","DRAWER_SPLITTER_ELEMENT","Resizer","height","minHeight","targetHeight","minWidth","onHorizontalResizeStop","resizerHandler","useMemo","uuid","w","setW","setCells","initalW","setInitialW","useLayoutEffect","listener","addEventListener","removeEventListener","onResizeStart","applicableCells","allCells","currentCell","initialWidth","getRect","someLast","cellContainsCurrent","contains","setAttribute","onResize","_e","data","size","delta","parseInt","getAttribute","onResizeStop","minConstraints","axis","handle","ResizerSupervisor","LiteralExpression","content","onUpdatingNameAndDataType","onUpdatingRecursiveExpression","useRef","expressionDataType","literalExpressionContent","literalExpressionWidth","spreadLiteralExpressionDefinition","onContentChange","renderElementWithResizeHandler","renderLiteralExpressionHeader","getBodyContent","TextArea","defaultValue","aria-label","TableBody","tableInstance","headerVisibility","Full","getRowKey","getColumnKey","renderCell","cellIndex","rowIndex","cellType","cellTemplate","render","Td","getCellProps","getTdProps","column","renderBodyRow","Tr","getRowProps","renderAdditiveRow","role","childIndex","allColumns","Tbody","None","getTableBodyProps","prepareRow","TableHandlerMenu","handlerConfiguration","allowedOperations","onOperation","Menu","itemId","groupOperation","MenuGroup","label","operation","MenuList","MenuItem","isDisabled","TableHandler","columnPrefix","tableColumns","lastSelectedColumnIndex","lastSelectedRowIndex","tableRows","onRowsUpdate","onRowAdding","showTableHandler","setShowTableHandler","tableHandlerTarget","tableHandlerAllowedOperations","resetRowCustomFunction","onColumnsUpdate","selectedColumnIndex","setSelectedColumnIndex","selectedRowIndex","setSelectedRowIndex","insertBefore","elements","insertAfter","deleteAt","generateNextAvailableColumnName","accessor","generateNextAvailableColumn","updateColumnsThenRows","handlingOperation","tableOperation","ColumnInsertLeft","ColumnInsertRight","ColumnDelete","hasNoPadding","showClose","isVisible","shouldClose","shouldOpen","showFunction","TableHeader","editColumnLabel","skipLastHeaderGroup","updateColumnNameInRows","prevColumnName","newColumnName","tableCells","assignedCellValue","onColumnNameOrDataTypeUpdate","columnIndex","updatedTableColumns","renderCountColumn","Th","getHeaderProps","data-ouia-component-type","renderHeaderCellInfo","headerCellElement","renderResizableHeaderCell","getThProps","renderColumn","isCountColumn","getHeaderGroups","headerGroups","renderHeaderGroups","headerGroup","getHeaderGroupProps","headers","renderAtLevelInHeaderGroups","level","Thead","noWrap","LastLevel","SecondToLastLevel","NO_TABLE_CONTEXT_MENU_CLASS","Table","tableId","defaultCell","headerLevels","tableRef","numberOfRowsColumn","generateNumberOfRowsSubColumnRecursively","disableResizing","hideFilter","setTableHandlerTarget","toString","setTableHandlerAllowedOperations","setLastSelectedColumnIndex","setLastSelectedRowIndex","onColumnsUpdateCallback","onRowsUpdateCallback","onCellUpdate","columnId","updatedTableCells","onRowUpdate","updatedRow","updatedRows","defaultColumn","cellRef","initialValue","setValue","EditableCell","contextMenuIsAvailable","targetIsContainedInCurrentTable","contextMenuAvailableForTarget","tableHandlerStateUpdate","currentlyOpenedHandlerCallback","setCurrentlyOpenedHandlerCallback","useTable","onContextMenu","handlerOnHeaderIsAvailable","disableHandlerOnHeader","preventDefault","useBlockLayout","useResizeColumns","resizeNestedColumns","updatedWidth","updatedColumn","splice","finishedResizing","state","columnResizing","isResizingColumn","columnWidths","updatedColumnWidth","TableComposable","getTableProps","ref","RelationExpression","relationProps","spreadRelationExpressionDefinition","convertColumnsForTheTable","convertRowsForTheTable","tableRow","onSavingRows","onSavingColumns","columnInstance","ContextEntryExpression","expression","onExpressionResetting","expressionContainerRef","expressionChangedExternally","getLogicTypeSelectorRef","onLogicTypeUpdating","onLogicTypeResetting","getPlacementRef","ContextEntryExpressionCell","ContextEntryInfo","onContextEntryUpdate","editInfoPopoverLabel","entryName","setEntryName","entryDataType","setEntryDataType","onEntryNameOrDataTypeUpdate","ContextEntryInfoCell","setEntryInfo","DEFAULT_CONTEXT_ENTRY_NAME","DEFAULT_CONTEXT_ENTRY_DATA_TYPE","ContextExpression","entryInfoWidth","resultExpression","setResultExpression","infoWidth","setInfoWidth","expressionWidth","setExpressionWidth","setColumns","setRows","expressionColumn","prevExpressionColumn","getHeaderVisibility","updatedDefinition","Context","DecisionTableExpression","ListExpression","generateLiteralExpression","item","listItems","setListItems","listExpressionWidth","listTableGetRowKey","spreadListExpressionDefinition","List","listItem","DEFAULT_PARAMETER_DATA_TYPE","InvocationExpression","bindingEntries","invokedFunction","functionDefinition","spreadInvocationExpressionDefinition","onFunctionDefinitionChange","onFunctionDefinitionBlur","updatedExpressionColumn","LogicTypeSelector","nextId","isLogicTypeSelected","logicTypeSelected","setLogicTypeSelected","opacity","bla","setBla","wrapperRef","xPos","setXPos","yPos","setYPos","contextMenuVisible","setContextMenuVisible","hideContextMenu","showContextMenu","pageX","pageY","contextMenuRef","contextMenuXPos","contextMenuYPos","contextMenuVisibility","setContextMenuVisibility","useContextMenuHandler","renderExpression","Relation","DecisionTable","Invocation","Function","getLogicTypesWithoutUndefined","renderLogicTypeItems","getArrowPlacement","getAppendToPlacement","onLogicTypeSelect","selectedLogicType","buildLogicSelectorMenu","executeClearAction","buildContextMenu","top","left","Button","isSmall","ButtonVariant","primary","onClick","ExpressionContainer","setSelectedExpression","updateExpressionNameAndDataType","updatedName","updatedDataType","previousSelectedExpression","BoxedExpressionEditor","defaults","dictionaries","initialLocale","navigator","language","ctx","Provider"],"mappings":"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","file":"static/js/main.1afa1afa.chunk.js","sourcesContent":["/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum BuiltinAggregation {\n  Sum = \"+\",\n  Count = \"#\",\n  Min = \"<\",\n  Max = \">\",\n}\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DataType } from \"./DataType\";\nimport { ExpressionProps } from \"./ExpressionProps\";\nimport * as _ from \"lodash\";\nimport { DataRecord, Row } from \"react-table\";\nimport { TableHandlerConfiguration, TableOperation } from \"./Table\";\nimport { BoxedExpressionEditorI18n } from \"../i18n\";\n\nexport interface ContextEntryRecord {\n  entryInfo: {\n    /** Entry name */\n    name: string;\n    /** Entry data type */\n    dataType: DataType;\n  };\n  /** Entry expression */\n  entryExpression: ExpressionProps;\n  /** Label used for the popover triggered when editing info section */\n  editInfoPopoverLabel: string;\n  /** Callback to be invoked on expression resetting */\n  onExpressionResetting?: () => void;\n}\n\nexport type ContextEntries = ContextEntryRecord[];\n\nexport const DEFAULT_ENTRY_INFO_MIN_WIDTH = 150;\nexport const DEFAULT_ENTRY_EXPRESSION_MIN_WIDTH = 370;\n\nexport const getHandlerConfiguration = (\n  i18n: BoxedExpressionEditorI18n,\n  groupName: string\n): TableHandlerConfiguration => [\n  {\n    group: groupName,\n    items: [\n      { name: i18n.rowOperations.insertAbove, type: TableOperation.RowInsertAbove },\n      { name: i18n.rowOperations.insertBelow, type: TableOperation.RowInsertBelow },\n      { name: i18n.rowOperations.delete, type: TableOperation.RowDelete },\n      { name: i18n.rowOperations.clear, type: TableOperation.RowClear },\n    ],\n  },\n];\n\nexport const generateNextAvailableEntryName = (\n  contextEntries: ContextEntries,\n  namePrefix: string,\n  lastIndex: number = contextEntries.length\n): string => {\n  const candidateName = `${namePrefix}-${lastIndex}`;\n  const entryWithCandidateName = _.find(contextEntries, { entryInfo: { name: candidateName } });\n  return entryWithCandidateName\n    ? generateNextAvailableEntryName(contextEntries, namePrefix, lastIndex + 1)\n    : candidateName;\n};\n\nexport const getEntryKey = (row: Row): string => (row.original as ContextEntryRecord).entryInfo.name;\n\nexport const resetEntry = (row: DataRecord): DataRecord => ({\n  entryInfo: row.entryInfo,\n  entryExpression: { uid: (row.entryExpression as ExpressionProps).uid },\n});\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum DataType {\n  Undefined = \"<Undefined>\",\n  Any = \"Any\",\n  Boolean = \"boolean\",\n  Context = \"context\",\n  Date = \"date\",\n  DateTime = \"date and time\",\n  DateTimeDuration = \"days and time duration\",\n  Number = \"number\",\n  String = \"string\",\n  Time = \"time\",\n  YearsMonthsDuration = \"years and months duration\",\n}\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum HitPolicy {\n  Unique = \"UNIQUE\",\n  First = \"FIRST\",\n  Priority = \"PRIORITY\",\n  Any = \"ANY\",\n  Collect = \"COLLECT\",\n  RuleOrder = \"RULE ORDER\",\n  OutputOrder = \"OUTPUT ORDER\",\n}\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport enum LogicType {\n  Undefined = \"<Undefined>\",\n  LiteralExpression = \"Literal expression\",\n  Context = \"Context\",\n  DecisionTable = \"Decision Table\",\n  Relation = \"Relation\",\n  Function = \"Function\",\n  Invocation = \"Invocation\",\n  List = \"List\",\n}\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BoxedExpressionEditorI18n } from \"..\";\nimport { en as en_common } from \"@kogito-tooling/i18n-common-dictionary\";\n\nexport const en: BoxedExpressionEditorI18n = {\n  ...en_common,\n  choose: \"Choose...\",\n  clear: \"Clear\",\n  columnOperations: {\n    delete: \"Delete\",\n    insertLeft: \"Insert left\",\n    insertRight: \"Insert right\",\n  },\n  columns: \"COLUMNS\",\n  context: \"Context\",\n  contextEntry: \"CONTEXT ENTRY\",\n  dataType: \"Data Type\",\n  decisionTable: \"Decision Table\",\n  editContextEntry: \"Edit Context Entry\",\n  editExpression: \"Edit Expression\",\n  editParameter: \"Edit Parameter\",\n  editRelation: \"Edit Relation\",\n  enterFunction: \"Enter function\",\n  function: \"Function\",\n  invocation: \"Invocation\",\n  list: \"List\",\n  literalExpression: \"Literal expression\",\n  name: \"Name\",\n  parameters: \"PARAMETERS\",\n  relation: \"Relation\",\n  rowOperations: {\n    clear: \"Clear\",\n    delete: \"Delete\",\n    insertAbove: \"Insert above\",\n    insertBelow: \"Insert below\",\n  },\n  rows: \"ROWS\",\n  selectExpression: \"Select expression\",\n  selectLogicType: \"Select logic type\",\n};\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as React from \"react\";\nimport { useContext } from \"react\";\nimport { en } from \"./locales\";\nimport { I18nContextType } from \"@kogito-tooling/i18n/dist/react-components\";\nimport { BoxedExpressionEditorI18n } from \"./BoxedExpressionEditorI18n\";\nimport { I18nDefaults, I18nDictionaries } from \"@kogito-tooling/i18n/dist/core\";\n\nexport const boxedExpressionEditorI18nDefaults: I18nDefaults<BoxedExpressionEditorI18n> = {\n  locale: \"en\",\n  dictionary: en,\n};\nexport const boxedExpressionEditorDictionaries: I18nDictionaries<BoxedExpressionEditorI18n> = new Map([[\"en\", en]]);\nexport const BoxedExpressionEditorI18nContext = React.createContext<I18nContextType<BoxedExpressionEditorI18n>>(\n  {} as never\n);\n\nexport function useBoxedExpressionEditorI18n(): I18nContextType<BoxedExpressionEditorI18n> {\n  return useContext(BoxedExpressionEditorI18nContext);\n}\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *       http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { BoxedExpressionEditor } from \"./components\";\nimport * as React from \"react\";\nimport { ExpressionProps } from \"./api\";\nimport * as ReactDOM from \"react-dom\";\n\nexport * from \"./components\";\nexport * from \"./api\";\n\nwindow.renderBoxedExpressionEditor = (selector: string, definition: ExpressionProps) => {\n  ReactDOM.render(\n    <BoxedExpressionEditor expressionDefinition={{ selectedExpression: definition }} />,\n    document.getElementById(selector)\n  );\n};\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as React from \"react\";\nimport { useState } from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport \"./index.css\";\n// noinspection ES6PreferShortImport\nimport {\n  BoxedExpressionEditor,\n  ContextProps,\n  DataType,\n  ExpressionContainerProps,\n  ExpressionProps,\n  InvocationProps,\n  ListProps,\n  LiteralExpressionProps,\n  RelationProps,\n} from \"./boxed_expression_editor\";\n\nexport const App: React.FunctionComponent = () => {\n  //This definition comes directly from the decision node\n  const selectedExpression: ExpressionProps = {\n    uid: \"id1\",\n    logicType: \"Context\",\n    name: \"Expression Name\",\n    dataType: \"<Undefined>\",\n    contextEntries: [\n      {\n        entryInfo: {\n          name: \"ContextEntry-1\",\n          dataType: \"<Undefined>\",\n        },\n        entryExpression: {\n          uid: \"id2\",\n          logicType: \"Relation\",\n          isHeadless: true,\n          columns: [\n            {\n              name: \"column-1\",\n              dataType: \"<Undefined>\",\n              width: 471,\n            },\n            {\n              name: \"column-2\",\n              dataType: \"<Undefined>\",\n              width: 137,\n            },\n            {\n              name: \"column-3\",\n              dataType: \"<Undefined>\",\n              width: 272,\n            },\n            {\n              name: \"column-4\",\n              dataType: \"<Undefined>\",\n              width: 385,\n            },\n          ],\n          rows: [[\"\", \"\", \"\", \"\"]],\n        },\n      },\n    ],\n    result: {\n      uid: \"id3\",\n      logicType: \"Context\",\n      contextEntries: [\n        {\n          entryInfo: {\n            name: \"ContextEntry-1\",\n            dataType: \"<Undefined>\",\n          },\n          entryExpression: {\n            uid: \"id6\",\n            logicType: \"Context\",\n            contextEntries: [\n              {\n                entryInfo: {\n                  name: \"ContextEntry-1\",\n                  dataType: \"<Undefined>\",\n                },\n                entryExpression: {},\n              },\n            ],\n            result: {\n              uid: \"id9\",\n            },\n          },\n        },\n      ],\n      result: {\n        uid: \"id7\",\n      },\n    },\n    entryExpressionWidth: 1493,\n  } as ExpressionProps;\n\n  const [updatedExpression, setUpdatedExpression] = useState(selectedExpression);\n\n  const expressionDefinition: ExpressionContainerProps = { selectedExpression };\n\n  //Defining global function that will be available in the Window namespace and used by the BoxedExpressionEditor component\n  window.beeApi = {\n    resetExpressionDefinition: (definition: ExpressionProps) => setUpdatedExpression(definition),\n    broadcastLiteralExpressionDefinition: (definition: LiteralExpressionProps) => setUpdatedExpression(definition),\n    broadcastRelationExpressionDefinition: (definition: RelationProps) => setUpdatedExpression(definition),\n    broadcastContextExpressionDefinition: (definition: ContextProps) => setUpdatedExpression(definition),\n    broadcastListExpressionDefinition: (definition: ListProps) => setUpdatedExpression(definition),\n    broadcastInvocationExpressionDefinition: (definition: InvocationProps) => setUpdatedExpression(definition),\n  };\n\n  return (\n    <div className=\"showcase\">\n      <div className=\"boxed-expression\">\n        <BoxedExpressionEditor expressionDefinition={expressionDefinition} />\n      </div>\n      <div className=\"updated-json\">\n        <p className=\"disclaimer\">\n          ⚠ Currently, JSON gets updated only for literal expression, relation, context, list and invocation logic types\n        </p>\n        <pre>{JSON.stringify(updatedExpression, null, 2)}</pre>\n      </div>\n    </div>\n  );\n};\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from \"./BoxedExpressionEditor\";\nexport * from \"./BuiltinAggregation\";\nexport * from \"./ContextEntry\";\nexport * from \"./DataType\";\nexport * from \"./DecisionTableRule\";\nexport * from \"./ExpressionProps\";\nexport * from \"./HitPolicy\";\nexport * from \"./LogicType\";\nexport * from \"./Table\";\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport * from \"./BoxedExpressionEditorI18n\";\nexport * from \"./setup\";\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DataType } from \"./DataType\";\nimport * as React from \"react\";\nimport { Column as ReactTableColumn, DataRecord, Row as ReactTableRow } from \"react-table\";\n\nexport interface TableProps {\n  /** Table identifier, useful for nested structures */\n  tableId?: string;\n  /** Optional children element to be appended below the table content */\n  children?: React.ReactElement[];\n  /** The prefix to be used for the column name */\n  columnPrefix?: string;\n  /** Optional label to be used for the edit popover that appears when clicking on column header */\n  editColumnLabel?: string;\n  /** For each column there is a default component to be used to render the related cell */\n  defaultCell?: {\n    [columnName: string]: React.FunctionComponent<CellProps>;\n  };\n  /** Table's columns */\n  columns: ReactTableColumn[];\n  /** Table's cells */\n  rows: DataRecord[];\n  /** Function to be executed when columns are modified */\n  onColumnsUpdate?: (columns: ReactTableColumn[]) => void;\n  /** Function to be executed when one or more rows are modified */\n  onRowsUpdate?: (rows: DataRecord[]) => void;\n  /** Function to be executed when adding a new row to the table */\n  onRowAdding?: () => DataRecord;\n  /** Custom configuration for the table handler */\n  handlerConfiguration: TableHandlerConfiguration;\n  /** The way in which the header will be rendered */\n  headerVisibility?: TableHeaderVisibility;\n  /** Number of levels in the header, 0-based */\n  headerLevels?: number;\n  /** True, for skipping the creation in the DOM of the last defined header group */\n  skipLastHeaderGroup?: boolean;\n  /** Custom function for getting row key prop, and avoid using the row index */\n  getRowKey?: (row: ReactTableRow) => string;\n  /** Custom function for getting column key prop, and avoid using the column index */\n  getColumnKey?: (column: ReactTableColumn) => string;\n  /** Custom function called for manually resetting a row */\n  resetRowCustomFunction?: (row: DataRecord) => DataRecord;\n}\n\n/** Possible status for the visibility of the Table's Header */\nexport enum TableHeaderVisibility {\n  Full,\n  LastLevel,\n  SecondToLastLevel,\n  None,\n}\n\n/** Table allowed operations */\nexport enum TableOperation {\n  ColumnInsertLeft,\n  ColumnInsertRight,\n  ColumnDelete,\n  RowInsertAbove,\n  RowInsertBelow,\n  RowDelete,\n  RowClear,\n}\n\nexport interface GroupOperations {\n  /** Name of the group (localized) */\n  group: string;\n  /** Collection of operations belonging to this group */\n  items: {\n    /** Name of the operation (localized) */\n    name: string;\n    /** Type of the operation */\n    type: TableOperation;\n  }[];\n}\n\nexport type TableHandlerConfiguration = GroupOperations[];\n\nexport type AllowedOperations = TableOperation[];\n\nexport type Row = string[];\n\nexport type Rows = Row[];\n\nexport interface Column {\n  /** Column name */\n  name: string;\n  /** Column data type */\n  dataType: DataType;\n  /** Column width */\n  width?: string | number;\n}\n\nexport type Columns = Column[];\n\nexport interface CellProps {\n  /** Cell's row properties */\n  row: { index: number };\n  /** Cell's column properties */\n  column: { id: string };\n}\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as React from \"react\";\nimport { Popover } from \"@patternfly/react-core\";\nimport \"./PopoverMenu.css\";\n\nexport interface PopoverMenuProps {\n  /** Optional children element to be considered for triggering the popover */\n  children?: React.ReactElement;\n  /** Title of the popover menu */\n  title: string;\n  /** A function which returns the HTMLElement where the popover's arrow should be placed */\n  arrowPlacement?: () => HTMLElement;\n  /** The content of the popover itself */\n  body: React.ReactNode;\n  /** The node where to append the popover content */\n  appendTo?: HTMLElement | ((ref?: HTMLElement) => HTMLElement);\n  /** Additional classname to be used for the popover */\n  className?: string;\n  /** True to have width automatically computed */\n  hasAutoWidth?: boolean;\n}\n\nexport const PopoverMenu: React.FunctionComponent<PopoverMenuProps> = ({\n  children,\n  arrowPlacement,\n  body,\n  title,\n  appendTo,\n  className,\n  hasAutoWidth,\n}: PopoverMenuProps) => {\n  return (\n    <Popover\n      data-ouia-component-id=\"expression-popover-menu\"\n      className={`popover-menu-selector${className ? \" \" + className : \"\"}`}\n      hasAutoWidth={hasAutoWidth}\n      position=\"bottom\"\n      distance={0}\n      id=\"menu-selector\"\n      reference={arrowPlacement}\n      appendTo={appendTo}\n      headerContent={\n        <div className=\"selector-menu-title\" data-ouia-component-id=\"expression-popover-menu-title\">\n          {title}\n        </div>\n      }\n      bodyContent={body}\n    >\n      {children}\n    </Popover>\n  );\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as React from \"react\";\n\nexport interface BoxedExpressionGlobalContextProps {\n  boxedExpressionEditorRef: React.RefObject<HTMLDivElement>;\n  currentlyOpenedHandlerCallback: React.Dispatch<React.SetStateAction<boolean>>;\n  setCurrentlyOpenedHandlerCallback: React.Dispatch<\n    React.SetStateAction<React.Dispatch<React.SetStateAction<boolean>>>\n  >;\n}\n\nexport const BoxedExpressionGlobalContext = React.createContext<BoxedExpressionGlobalContextProps>(\n  {} as BoxedExpressionGlobalContextProps\n);\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport \"./EditExpressionMenu.css\";\nimport * as React from \"react\";\nimport { useCallback, useContext, useEffect, useState } from \"react\";\nimport { PopoverMenu } from \"../PopoverMenu\";\nimport { useBoxedExpressionEditorI18n } from \"../../i18n\";\nimport { DataType, ExpressionProps } from \"../../api\";\nimport { Select, SelectOption, SelectVariant } from \"@patternfly/react-core\";\nimport * as _ from \"lodash\";\nimport { BoxedExpressionGlobalContext } from \"../../context\";\n\nexport interface EditExpressionMenuProps {\n  /** Optional children element to be considered for triggering the edit expression menu */\n  children?: React.ReactElement;\n  /** The node where to append the popover content */\n  appendTo?: HTMLElement | ((ref?: HTMLElement) => HTMLElement);\n  /** A function which returns the HTMLElement where the popover's arrow should be placed */\n  arrowPlacement?: () => HTMLElement;\n  /** The label for the field 'Name' */\n  nameField?: string;\n  /** The label for the field 'Data Type' */\n  dataTypeField?: string;\n  /** The title of the popover menu */\n  title?: string;\n  /** The pre-selected data type */\n  selectedDataType?: DataType;\n  /** The pre-selected expression name */\n  selectedExpressionName: string;\n  /** Function to be called when the expression gets updated, passing the most updated version of it */\n  onExpressionUpdate: (expression: ExpressionProps) => void;\n}\n\nexport const EXPRESSION_NAME = \"Expression Name\";\n\nexport const EditExpressionMenu: React.FunctionComponent<EditExpressionMenuProps> = ({\n  children,\n  appendTo,\n  arrowPlacement,\n  title,\n  nameField,\n  dataTypeField,\n  selectedDataType = DataType.Undefined,\n  selectedExpressionName,\n  onExpressionUpdate,\n}: EditExpressionMenuProps) => {\n  const globalContext = useContext(BoxedExpressionGlobalContext);\n  const { i18n } = useBoxedExpressionEditorI18n();\n  title = title ?? i18n.editExpression;\n  nameField = nameField ?? i18n.name;\n  dataTypeField = dataTypeField ?? i18n.dataType;\n  appendTo = appendTo ?? globalContext.boxedExpressionEditorRef?.current ?? undefined;\n\n  const [dataTypeSelectOpen, setDataTypeSelectOpen] = useState(false);\n  const [dataType, setDataType] = useState(selectedDataType);\n  const [expressionName, setExpressionName] = useState(selectedExpressionName);\n\n  useEffect(() => {\n    setExpressionName(selectedExpressionName);\n  }, [selectedExpressionName]);\n\n  useEffect(() => {\n    setDataType(selectedDataType);\n  }, [selectedDataType]);\n\n  const onExpressionNameChange = useCallback(\n    (event) => {\n      setExpressionName(event.target.value);\n      if (event.type === \"blur\") {\n        onExpressionUpdate({\n          name: event.target.value,\n          dataType,\n        });\n      }\n    },\n    [dataType, onExpressionUpdate]\n  );\n\n  const onDataTypeSelect = useCallback(\n    (event, selection) => {\n      setDataTypeSelectOpen(false);\n      setDataType(selection);\n      onExpressionUpdate({\n        name: expressionName,\n        dataType: selection,\n      });\n    },\n    [expressionName, onExpressionUpdate]\n  );\n\n  const getDataTypes = useCallback(() => {\n    return _.map(Object.values(DataType), (key) => (\n      <SelectOption key={key} value={key}>\n        {key}\n      </SelectOption>\n    ));\n  }, []);\n\n  const onDataTypeFilter = useCallback(\n    (e: React.ChangeEvent<HTMLInputElement>) => {\n      let input: RegExp;\n      try {\n        input = new RegExp(e.target.value, \"i\");\n      } catch (exception) {\n        return getDataTypes();\n      }\n      return e.target.value !== \"\" ? getDataTypes().filter((child) => input.test(child.props.value)) : getDataTypes();\n    },\n    [getDataTypes]\n  );\n\n  const onDataTypeSelectToggle = useCallback((isOpen) => setDataTypeSelectOpen(isOpen), []);\n\n  return (\n    <PopoverMenu\n      title={title}\n      arrowPlacement={arrowPlacement}\n      appendTo={appendTo}\n      body={\n        <div className=\"edit-expression-menu\">\n          <div className=\"expression-name\">\n            <label>{nameField}</label>\n            <input\n              type=\"text\"\n              id=\"expression-name\"\n              data-ouia-component-id=\"edit-expression-name\"\n              value={expressionName}\n              onChange={onExpressionNameChange}\n              onBlur={onExpressionNameChange}\n              className=\"form-control pf-c-form-control\"\n              placeholder={EXPRESSION_NAME}\n            />\n          </div>\n          <div className=\"expression-data-type\">\n            <label>{dataTypeField}</label>\n            <Select\n              ouiaId=\"edit-expression-data-type\"\n              variant={SelectVariant.typeahead}\n              typeAheadAriaLabel={i18n.choose}\n              onToggle={onDataTypeSelectToggle}\n              onSelect={onDataTypeSelect}\n              onFilter={onDataTypeFilter}\n              isOpen={dataTypeSelectOpen}\n              selections={dataType}\n              hasInlineFilter\n              inlineFilterPlaceholderText={i18n.choose}\n            >\n              {getDataTypes()}\n            </Select>\n          </div>\n        </div>\n      }\n    >\n      {children}\n    </PopoverMenu>\n  );\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as _ from \"lodash\";\n\nexport class Cell {\n  private static DEFAULT_WIDTH = 250; // TODO pick width from React\n  private static PADDING = 14; // TODO: we could get it via JS, performance reasons we don't\n\n  private id: string | undefined;\n  private lastColumn: boolean | undefined;\n  private rect: DOMRect | undefined;\n\n  constructor(public element: HTMLElement, public children: Cell[], public depth: number) {}\n\n  getId(): string {\n    if (this.id === undefined) {\n      this.id = _.first([].slice.call(this.element.classList).filter((c: string) => c.match(/uuid-/g))) || \"\";\n    }\n    return this.id;\n  }\n\n  getRect(): DOMRect {\n    if (this.rect === undefined) {\n      this.rect = this.element.getBoundingClientRect();\n    }\n    return this.rect;\n  }\n\n  isLastColumn(): boolean {\n    if (this.lastColumn === undefined) {\n      const parent = this.element.closest(\"tr\");\n      const isLast = parent?.lastChild == this.element.closest(\"th, td\");\n      this.lastColumn = isLast;\n    }\n    return this.lastColumn;\n  }\n\n  setWidth(width: number): void {\n    const cellWidth = width < 100 ? 100 : width;\n\n    // propagate to React state\n    document.dispatchEvent(new CustomEvent(this.getId(), { detail: { width: cellWidth } }));\n\n    // set on element to the \"live\" resize\n    this.element.style.width = cellWidth + \"px\";\n  }\n\n  refreshWidthAsParent(): void {\n    this.setWidth(this.fetchChildWidth() + Cell.PADDING);\n  }\n\n  refreshWidthAsLastColumn(): void {\n    if (!this.isLastColumn()) {\n      return;\n    }\n\n    const parentRect = this.element.closest(\"tr\")?.getBoundingClientRect();\n    if (parentRect === undefined) {\n      return;\n    }\n\n    const cellRect = this.element.getBoundingClientRect();\n    const width = parentRect.right - cellRect.x - 15;\n\n    this.setWidth(width + Cell.PADDING);\n  }\n\n  /**\n   * [TODO]\n   * We cannot calculate as css styles may change\n   */\n  private fetchChildWidth() {\n    const thead = this.element.querySelector(\"thead, tbody\");\n    return thead?.getBoundingClientRect().width || Cell.DEFAULT_WIDTH;\n  }\n}\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Cell } from \"./\";\n\nexport class DOMSession {\n  private static CELL_CSS_SELCTOR = \".react-resizable\";\n\n  private cells: Cell[] | undefined;\n\n  getCells(): Cell[] {\n    if (this.cells === undefined) {\n      this.cells = this.buildCells();\n    }\n    return this.cells;\n  }\n\n  private buildCells() {\n    const cells: Cell[] = [];\n    this.fetchCellElements(document.body).forEach((cellElement) => {\n      this.buildCell(cellElement, cells, 0);\n    });\n    return cells;\n  }\n\n  private buildCell(htmlElement: HTMLElement, cells: Cell[], depthLevel: number): Cell {\n    const exitingElement = cells.find((c) => c.element === htmlElement);\n    if (exitingElement) {\n      return exitingElement;\n    }\n\n    const cell = new Cell(\n      htmlElement,\n      this.fetchCellElements(htmlElement)\n        .map((child) => this.buildCell(child, cells, depthLevel + 1))\n        .filter((c) => c.depth == depthLevel + 1),\n      depthLevel\n    );\n\n    cells.push(cell);\n\n    return cell;\n  }\n\n  private fetchCellElements(parent: HTMLElement): HTMLElement[] {\n    const htmlElements = parent.querySelectorAll(DOMSession.CELL_CSS_SELCTOR);\n    return [].slice.call(htmlElements);\n  }\n}\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DOMSession, Cell } from \"./\";\n\n/**\n * [TODO]\n * React state + hooks abstractions have a level of granularity that limits the\n * frame hate in the context of the boxed expression component.\n * Setting targets/dependencies for effects would generate a huge amount of\n * function calls.\n * This component intentionally access DOM logic, but it should be spread across\n * the component.\n */\nexport const applyDOMSupervisor = (): void => {\n  throttling(() => {\n    new SupervisorExecution().execute();\n  });\n};\n\nclass SupervisorExecution {\n  domSession: DOMSession;\n\n  constructor() {\n    this.domSession = new DOMSession();\n  }\n\n  updateSize(cell: Cell) {\n    if (cell.children.length > 0) {\n      cell.refreshWidthAsParent();\n    }\n  }\n\n  updateLastColumns(cell: Cell) {\n    cell.refreshWidthAsLastColumn();\n  }\n\n  execute() {\n    const cells = this.domSession.getCells();\n\n    const p1 = performance.now();\n    for (let index = 0; index < 10; index++) {\n      cells.sort((c1, c2) => c2.depth - c1.depth).forEach(this.updateSize);\n      cells.sort((c1, c2) => c1.depth - c2.depth).forEach(this.updateLastColumns);\n    }\n    const p2 = performance.now();\n    console.log(p2 - p1 + \"ms\");\n  }\n}\n\nlet latestCall = 0;\n\nfunction throttling(fn: () => void) {\n  if (latestCall === 0) {\n    fn();\n  }\n\n  latestCall = window.setTimeout(() => {\n    window.clearInterval(latestCall);\n    latestCall = 0;\n  }, 100);\n}\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport \"./Resizer.css\";\nimport * as React from \"react\";\nimport { useCallback, useMemo, useState, useLayoutEffect } from \"react\";\nimport { ResizableBox } from \"react-resizable\";\nimport { v4 as uuid } from \"uuid\";\nimport * as _ from \"lodash\";\nimport { Cell, DOMSession } from \"./dom\";\n\nexport interface ResizerProps {\n  width: number;\n  height: number | \"100%\";\n  minWidth: number;\n  minHeight?: number;\n  onHorizontalResizeStop: (width: number) => void;\n  children?: React.ReactElement;\n}\n\nexport const DRAWER_SPLITTER_ELEMENT = (\n  <div className=\"pf-c-drawer__splitter pf-m-vertical\">\n    <div className=\"pf-c-drawer__splitter-handle\" />\n  </div>\n);\n\nexport const Resizer: React.FunctionComponent<ResizerProps> = ({\n  children,\n  height,\n  minHeight = 0,\n  minWidth,\n  onHorizontalResizeStop,\n  width,\n}) => {\n  const targetHeight = height === \"100%\" ? 0 : height;\n  const resizerHandler = useMemo(() => <div className=\"pf-c-drawer\">{DRAWER_SPLITTER_ELEMENT}</div>, []);\n  const id = useMemo(() => `uuid-${uuid()}`, []);\n  const [w, setW] = useState(300);\n  const x: Cell[] = [];\n  const [cells, setCells] = useState(x);\n  const [initalW, setInitialW] = useState(0);\n\n  useLayoutEffect(() => {\n    function listener(event: CustomEvent) {\n      const width = event.detail.width;\n      setW(width);\n    }\n\n    document.addEventListener(id, listener);\n    return () => {\n      document.removeEventListener(id, listener);\n    };\n  }, [id]);\n\n  const onResizeStart = useCallback(() => {\n    const applicableCells: Cell[] = [];\n    const allCells = new DOMSession().getCells();\n    const currentCell = allCells.find((c) => c.getId() === id)!;\n    const initialWidth = currentCell.getRect().width;\n    const parent = currentCell.element.closest(\"table\");\n\n    let someLast = false;\n\n    if (currentCell.isLastColumn()) {\n      allCells\n        .filter((cell) => cell.isLastColumn())\n        .forEach((cell) => {\n          applicableCells.push(cell);\n        });\n    } else {\n      allCells.forEach((cell) => {\n        const cellContainsCurrent =\n          cell.getRect().x <= currentCell.getRect().x && cell.getRect().right >= currentCell.getRect().right;\n\n        if ((parent?.contains(cell.element) || cell.element?.contains(currentCell.element)) && cellContainsCurrent) {\n          applicableCells.push(cell);\n          if (cell.isLastColumn()) {\n            someLast = true;\n          }\n        }\n      });\n\n      if (someLast) {\n        allCells\n          .filter((cell) => cell.isLastColumn() && !parent?.contains(cell.element))\n          .forEach((cell) => {\n            applicableCells.push(cell);\n          });\n      }\n    }\n\n    applicableCells.forEach((cell) => {\n      cell.element.setAttribute(\"data-initial-w\", cell.element.style.width);\n    });\n\n    setCells(applicableCells);\n    setInitialW(initialWidth);\n  }, [id]);\n\n  const onResize = useCallback(\n    (_e, data) => {\n      const width = data.size.width < 100 ? 100 : data.size.width;\n      cells.forEach((c) => {\n        const delta = width - initalW;\n        if (c.getId() !== id) {\n          c.element.style.width = parseInt(c.element.getAttribute(\"data-initial-w\") || \"\") + delta + \"px\";\n        }\n      }, []);\n    },\n    [cells, id, initalW]\n  );\n\n  const onResizeStop = useCallback(\n    (_e, data) => {\n      cells.forEach((c) => {\n        const width = data.size.width < 100 ? 100 : data.size.width;\n        const delta = width - initalW;\n        document.dispatchEvent(\n          new CustomEvent(c.getId(), {\n            detail: { width: parseInt(c.element.getAttribute(\"data-initial-w\") || \"\") + delta },\n          })\n        );\n      }, []);\n    },\n    [cells, initalW]\n  );\n\n  return useMemo(\n    () => (\n      <ResizableBox\n        className={`${height === \"100%\" ? \"height-based-on-content\" : \"\"} ${id}`}\n        width={w}\n        height={targetHeight}\n        minConstraints={[100, minHeight]}\n        axis=\"x\"\n        onResizeStop={onResizeStop}\n        onResize={onResize}\n        onResizeStart={onResizeStart}\n        handle={resizerHandler}\n      >\n        {children}\n      </ResizableBox>\n    ),\n    [height, id, w, targetHeight, minHeight, onResizeStop, onResize, onResizeStart, resizerHandler, children]\n  );\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport \"./Resizer.css\";\nimport * as React from \"react\";\nimport { useEffect, useContext } from \"react\";\nimport { applyDOMSupervisor } from \"./dom\";\nimport { BoxedExpressionGlobalContext } from \"../../context\";\n\nexport interface ResizerSupervisorProps {\n  children?: React.ReactElement;\n}\n\nexport const ResizerSupervisor: React.FunctionComponent<ResizerSupervisorProps> = ({ children }) => {\n  const globalContext = useContext(BoxedExpressionGlobalContext);\n  useEffect(() => applyDOMSupervisor(), [globalContext]);\n  return <div>{children}</div>;\n};\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport \"./LiteralExpression.css\";\nimport * as React from \"react\";\nimport { useCallback, useEffect, useMemo, useRef } from \"react\";\nimport { DataType, ExpressionProps, LiteralExpressionProps, LogicType } from \"../../api\";\nimport { TextArea } from \"@patternfly/react-core\";\nimport { EditExpressionMenu, EXPRESSION_NAME } from \"../EditExpressionMenu\";\nimport { Resizer } from \"../Resizer\";\n\nexport const LiteralExpression: React.FunctionComponent<LiteralExpressionProps> = ({\n  uid,\n  content = \"\",\n  dataType = DataType.Undefined,\n  name = EXPRESSION_NAME,\n  onUpdatingNameAndDataType,\n  isHeadless = false,\n  onUpdatingRecursiveExpression,\n  width,\n}: LiteralExpressionProps) => {\n  const HEADER_WIDTH = 250;\n  const HEADER_HEIGHT = 40;\n\n  const expressionName = useRef<string>(name);\n  const expressionDataType = useRef<DataType>(dataType);\n  const literalExpressionContent = useRef<string>(content);\n  const literalExpressionWidth = useRef<number>(width || HEADER_WIDTH);\n\n  const spreadLiteralExpressionDefinition = useCallback(() => {\n    const expressionDefinition: LiteralExpressionProps = {\n      uid,\n      name: expressionName.current,\n      dataType: expressionDataType.current,\n      logicType: LogicType.LiteralExpression,\n      content: literalExpressionContent.current,\n      ...(!isHeadless && literalExpressionWidth.current !== HEADER_WIDTH\n        ? { width: literalExpressionWidth.current }\n        : {}),\n    };\n    isHeadless\n      ? onUpdatingRecursiveExpression?.(expressionDefinition)\n      : window.beeApi?.broadcastLiteralExpressionDefinition?.(expressionDefinition);\n  }, [isHeadless, onUpdatingRecursiveExpression, uid]);\n\n  const onExpressionUpdate = useCallback(\n    ({ dataType = DataType.Undefined, name = EXPRESSION_NAME }: ExpressionProps) => {\n      expressionName.current = name;\n      expressionDataType.current = dataType;\n      onUpdatingNameAndDataType?.(name, dataType);\n      spreadLiteralExpressionDefinition();\n    },\n    [onUpdatingNameAndDataType, spreadLiteralExpressionDefinition]\n  );\n\n  const onContentChange = useCallback(\n    (event) => {\n      literalExpressionContent.current = event.target.value;\n      spreadLiteralExpressionDefinition();\n    },\n    [spreadLiteralExpressionDefinition]\n  );\n\n  const onHorizontalResizeStop = useCallback(\n    (width) => {\n      literalExpressionWidth.current = width;\n      spreadLiteralExpressionDefinition();\n    },\n    [spreadLiteralExpressionDefinition]\n  );\n\n  const renderElementWithResizeHandler = useCallback(\n    (element) => (\n      <Resizer\n        width={literalExpressionWidth.current}\n        height={HEADER_HEIGHT}\n        minWidth={HEADER_WIDTH}\n        minHeight={HEADER_HEIGHT}\n        onHorizontalResizeStop={onHorizontalResizeStop}\n      >\n        {element}\n      </Resizer>\n    ),\n    [onHorizontalResizeStop]\n  );\n\n  const renderLiteralExpressionHeader = useMemo(() => {\n    return (\n      <div className=\"literal-expression-header\">\n        {renderElementWithResizeHandler(\n          <EditExpressionMenu\n            selectedExpressionName={expressionName.current}\n            selectedDataType={expressionDataType.current}\n            onExpressionUpdate={onExpressionUpdate}\n          >\n            <div className=\"expression-info\">\n              <p className=\"expression-name pf-u-text-truncate\">{expressionName.current}</p>\n              <p className=\"expression-data-type pf-u-text-truncate\">({expressionDataType.current})</p>\n            </div>\n          </EditExpressionMenu>\n        )}\n      </div>\n    );\n  }, [onExpressionUpdate, renderElementWithResizeHandler]);\n\n  const getBodyContent = useMemo(\n    () => (\n      <TextArea\n        defaultValue={literalExpressionContent.current}\n        onBlur={onContentChange}\n        aria-label=\"literal-expression-content\"\n      />\n    ),\n    [onContentChange]\n  );\n\n  useEffect(() => {\n    /** Function executed only the first time the component is loaded */\n    spreadLiteralExpressionDefinition();\n  }, [spreadLiteralExpressionDefinition]);\n\n  return (\n    <div className=\"literal-expression\">\n      {!isHeadless ? renderLiteralExpressionHeader : null}\n      <div className=\"literal-expression-body\">{getBodyContent}</div>\n    </div>\n  );\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as React from \"react\";\nimport { useCallback, useMemo } from \"react\";\nimport { Tbody, Td, Tr } from \"@patternfly/react-table\";\nimport { TableHeaderVisibility } from \"../../api\";\nimport { Cell, Column, Row, TableInstance } from \"react-table\";\nimport { DRAWER_SPLITTER_ELEMENT, Resizer } from \"../Resizer\";\n\nexport interface TableBodyProps {\n  /** Table instance */\n  tableInstance: TableInstance;\n  /** The way in which the header will be rendered */\n  headerVisibility?: TableHeaderVisibility;\n  /** Optional children element to be appended below the table content */\n  children?: React.ReactElement[];\n  /** Custom function for getting row key prop, and avoid using the row index */\n  getRowKey: (row: Row) => string;\n  /** Custom function for getting column key prop, and avoid using the column index */\n  getColumnKey: (column: Column) => string;\n}\n\nexport const TableBody: React.FunctionComponent<TableBodyProps> = ({\n  tableInstance,\n  children,\n  headerVisibility = TableHeaderVisibility.Full,\n  getRowKey,\n  getColumnKey,\n}) => {\n  // const renderCellResizer = useCallback(\n  //   (cell: Cell) => (\n  //     <div\n  //       className=\"pf-c-drawer drawer-on-body\"\n  //       {...(cell.column.getResizerProps ? cell.column.getResizerProps() : {})}\n  //     >\n  //       {DRAWER_SPLITTER_ELEMENT}\n  //     </div>\n  //   ),\n  //   []\n  // );\n\n  const onHorizontalResizeStop = useCallback((width) => {\n    // console.log(\">>>>>\" + width);\n  }, []);\n\n  const renderCell = useCallback(\n    (cellIndex: number, cell: Cell, rowIndex: number) => {\n      const cellType = cellIndex === 0 ? \"counter-cell\" : \"data-cell\";\n      // const canResize = \"has-resizer\";\n      const cellTemplate =\n        cellIndex === 0 ? (\n          <>{rowIndex + 1}</>\n        ) : (\n          <Resizer width={300} height=\"100%\" minWidth={10} onHorizontalResizeStop={onHorizontalResizeStop}>\n            <>{cell.render(\"Cell\")}</>\n          </Resizer>\n        );\n      return (\n        <Td\n          {...(cellIndex === 0 ? {} : cell.getCellProps())}\n          {...tableInstance.getTdProps(cellIndex, rowIndex)}\n          key={`${getColumnKey(cell.column)}-${cellIndex}`}\n          data-ouia-component-id={\"expression-column-\" + cellIndex}\n          className={`${cellType}`}\n        >\n          {cellTemplate}\n        </Td>\n      );\n    },\n    [getColumnKey, onHorizontalResizeStop, tableInstance]\n  );\n\n  const renderBodyRow = useCallback(\n    (row: Row, rowIndex: number) => (\n      <Tr\n        className=\"table-row\"\n        {...row.getRowProps()}\n        key={`${getRowKey(row)}-${rowIndex}`}\n        ouiaId={\"expression-row-\" + rowIndex}\n      >\n        {row.cells.map((cell: Cell, cellIndex: number) => renderCell(cellIndex, cell, rowIndex))}\n      </Tr>\n    ),\n    [getRowKey, renderCell]\n  );\n\n  const renderAdditiveRow = useMemo(\n    () => (\n      <Tr className=\"table-row additive-row\">\n        <Td role=\"cell\" className=\"empty-cell\">\n          <br />\n        </Td>\n        {children?.map((child, childIndex) => {\n          return (\n            <Td\n              role=\"cell\"\n              key={childIndex}\n              className=\"row-remainder-content\"\n              style={\n                {\n                  // width: tableInstance.allColumns[childIndex + 1].width,\n                  // minWidth: tableInstance.allColumns[childIndex + 1].minWidth,\n                }\n              }\n            >\n              {child}\n            </Td>\n          );\n        })}\n      </Tr>\n    ),\n    [children, tableInstance.allColumns]\n  );\n\n  return (\n    <Tbody\n      className={`${headerVisibility === TableHeaderVisibility.None ? \"missing-header\" : \"\"}`}\n      {...tableInstance.getTableBodyProps()}\n    >\n      {tableInstance.rows.map((row: Row, rowIndex: number) => {\n        tableInstance.prepareRow(row);\n        return renderBodyRow(row, rowIndex);\n      })}\n      {children ? renderAdditiveRow : null}\n    </Tbody>\n  );\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport \"./TableHandlerMenu.css\";\nimport * as React from \"react\";\nimport { Menu, MenuGroup, MenuItem, MenuList } from \"@patternfly/react-core\";\nimport { AllowedOperations, TableHandlerConfiguration, TableOperation } from \"../../api\";\nimport * as _ from \"lodash\";\n\nexport interface TableHandlerMenuProps {\n  /** Handler menu groups and items */\n  handlerConfiguration: TableHandlerConfiguration;\n  /** Dynamic Allowed operations */\n  allowedOperations: AllowedOperations;\n  /** Function to be executed when an operation gets selected */\n  onOperation: (operation: TableOperation) => void;\n}\n\nexport const TableHandlerMenu: React.FunctionComponent<TableHandlerMenuProps> = ({\n  handlerConfiguration,\n  allowedOperations,\n  onOperation,\n}) => {\n  return (\n    <Menu\n      ouiaId=\"expression-table-handler-menu\"\n      className=\"table-handler-menu\"\n      onSelect={(event, itemId) => onOperation(itemId)}\n    >\n      {handlerConfiguration.map((groupOperation) => (\n        <MenuGroup\n          key={groupOperation.group}\n          label={groupOperation.group}\n          className={\n            _.every(groupOperation.items, (operation) => !_.includes(allowedOperations, operation.type))\n              ? \"no-allowed-actions-in-group\"\n              : \"\"\n          }\n        >\n          <MenuList>\n            {groupOperation.items.map((operation) => (\n              <MenuItem\n                data-ouia-component-id={\"expression-table-handler-menu-\" + operation.name}\n                key={operation.type}\n                itemId={operation.type}\n                isDisabled={!_.includes(allowedOperations, operation.type)}\n              >\n                {operation.name}\n              </MenuItem>\n            ))}\n          </MenuList>\n        </MenuGroup>\n      ))}\n    </Menu>\n  );\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as React from \"react\";\nimport { useCallback, useContext, useEffect, useMemo, useState } from \"react\";\nimport { DataType, TableHandlerConfiguration, TableOperation } from \"../../api\";\nimport * as _ from \"lodash\";\nimport { Column, ColumnInstance, DataRecord } from \"react-table\";\nimport { Popover } from \"@patternfly/react-core\";\nimport { TableHandlerMenu } from \"./TableHandlerMenu\";\nimport { BoxedExpressionGlobalContext } from \"../../context\";\n\nexport interface TableHandlerProps {\n  /** The prefix to be used for the column name */\n  columnPrefix: string;\n  /** Columns instance */\n  tableColumns: React.MutableRefObject<Column[]>;\n  /** Last selected column index */\n  lastSelectedColumnIndex: number;\n  /** Last selected row index */\n  lastSelectedRowIndex: number;\n  /** Rows instance */\n  tableRows: React.MutableRefObject<DataRecord[]>;\n  /** Function to be executed when one or more rows are modified */\n  onRowsUpdate: (rows: DataRecord[]) => void;\n  /** Function to be executed when adding a new row to the table */\n  onRowAdding: () => DataRecord;\n  /** Show/hide table handler */\n  showTableHandler: boolean;\n  /** Function to programmatically show/hide table handler */\n  setShowTableHandler: React.Dispatch<React.SetStateAction<boolean>>;\n  /** Target for showing the table handler  */\n  tableHandlerTarget: HTMLElement;\n  /** Custom configuration for the table handler */\n  handlerConfiguration: TableHandlerConfiguration;\n  /** Table handler allowed operations */\n  tableHandlerAllowedOperations: TableOperation[];\n  /** Custom function called for manually resetting a row */\n  resetRowCustomFunction?: (row: DataRecord) => DataRecord;\n  /** Function to be executed when columns are modified */\n  onColumnsUpdate: (columns: Column[]) => void;\n}\n\nexport const TableHandler: React.FunctionComponent<TableHandlerProps> = ({\n  columnPrefix,\n  tableColumns,\n  lastSelectedColumnIndex,\n  lastSelectedRowIndex,\n  tableRows,\n  onRowsUpdate,\n  onRowAdding,\n  showTableHandler,\n  setShowTableHandler,\n  tableHandlerTarget,\n  handlerConfiguration,\n  tableHandlerAllowedOperations,\n  resetRowCustomFunction = () => ({}),\n  onColumnsUpdate,\n}) => {\n  const globalContext = useContext(BoxedExpressionGlobalContext);\n\n  const [selectedColumnIndex, setSelectedColumnIndex] = useState(lastSelectedColumnIndex);\n  const [selectedRowIndex, setSelectedRowIndex] = useState(lastSelectedRowIndex);\n\n  useEffect(() => {\n    setSelectedColumnIndex(lastSelectedColumnIndex);\n  }, [lastSelectedColumnIndex]);\n\n  useEffect(() => {\n    setSelectedRowIndex(lastSelectedRowIndex);\n  }, [lastSelectedRowIndex]);\n\n  const insertBefore = <T extends unknown>(elements: T[], index: number, element: T) => {\n    return [...elements.slice(0, index), element, ...elements.slice(index)];\n  };\n\n  const insertAfter = <T extends unknown>(elements: T[], index: number, element: T) => {\n    return [...elements.slice(0, index + 1), element, ...elements.slice(index + 1)];\n  };\n\n  const deleteAt = <T extends unknown>(elements: T[], index: number) => {\n    return [...elements.slice(0, index), ...elements.slice(index + 1)];\n  };\n\n  const clearAt = <T extends unknown>(elements: T[], index: number) => {\n    return [\n      ...elements.slice(0, index),\n      resetRowCustomFunction(elements[index] as DataRecord),\n      ...elements.slice(index + 1),\n    ];\n  };\n\n  const generateNextAvailableColumnName: (lastIndex: number) => string = useCallback(\n    (lastIndex) => {\n      const candidateName = `${columnPrefix}${lastIndex}`;\n      const columnWithCandidateName = _.find(tableColumns.current, { accessor: candidateName });\n      return columnWithCandidateName ? generateNextAvailableColumnName(lastIndex + 1) : candidateName;\n    },\n    [columnPrefix, tableColumns]\n  );\n\n  const generateNextAvailableColumn = useCallback(\n    (columns: Column[]) => {\n      return {\n        accessor: generateNextAvailableColumnName(columns.length),\n        label: generateNextAvailableColumnName(columns.length),\n        dataType: DataType.Undefined,\n      } as ColumnInstance;\n    },\n    [generateNextAvailableColumnName]\n  );\n\n  /** These column operations have impact also on the collection of cells */\n  const updateColumnsThenRows = useCallback(\n    (columns) => {\n      onColumnsUpdate(columns);\n      onRowsUpdate(tableRows.current);\n    },\n    [onColumnsUpdate, onRowsUpdate, tableRows]\n  );\n\n  const handlingOperation = useCallback(\n    (tableOperation: TableOperation) => {\n      switch (tableOperation) {\n        case TableOperation.ColumnInsertLeft:\n          updateColumnsThenRows(\n            insertBefore(tableColumns.current, selectedColumnIndex, generateNextAvailableColumn(tableColumns.current))\n          );\n          break;\n        case TableOperation.ColumnInsertRight:\n          updateColumnsThenRows(\n            insertAfter(tableColumns.current, selectedColumnIndex, generateNextAvailableColumn(tableColumns.current))\n          );\n          break;\n        case TableOperation.ColumnDelete:\n          updateColumnsThenRows(deleteAt(tableColumns.current, selectedColumnIndex));\n          break;\n        case TableOperation.RowInsertAbove:\n          onRowsUpdate(insertBefore(tableRows.current, selectedRowIndex, onRowAdding()));\n          break;\n        case TableOperation.RowInsertBelow:\n          onRowsUpdate(insertAfter(tableRows.current, selectedRowIndex, onRowAdding()));\n          break;\n        case TableOperation.RowDelete:\n          onRowsUpdate(deleteAt(tableRows.current, selectedRowIndex));\n          break;\n        case TableOperation.RowClear:\n          onRowsUpdate(clearAt(tableRows.current, selectedRowIndex));\n          break;\n      }\n      setShowTableHandler(false);\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [\n      generateNextAvailableColumn,\n      updateColumnsThenRows,\n      onRowAdding,\n      onRowsUpdate,\n      selectedColumnIndex,\n      selectedRowIndex,\n      setShowTableHandler,\n      tableColumns,\n      tableRows,\n    ]\n  );\n\n  return useMemo(\n    () => (\n      <Popover\n        className=\"table-handler\"\n        hasNoPadding\n        showClose={false}\n        distance={5}\n        position={\"right\"}\n        isVisible={showTableHandler}\n        shouldClose={() => setShowTableHandler(false)}\n        shouldOpen={(showFunction) => showFunction?.()}\n        reference={() => tableHandlerTarget}\n        appendTo={globalContext.boxedExpressionEditorRef?.current ?? undefined}\n        bodyContent={\n          <TableHandlerMenu\n            handlerConfiguration={handlerConfiguration}\n            allowedOperations={tableHandlerAllowedOperations}\n            onOperation={handlingOperation}\n          />\n        }\n      />\n    ),\n    [\n      showTableHandler,\n      globalContext.boxedExpressionEditorRef,\n      handlerConfiguration,\n      tableHandlerAllowedOperations,\n      handlingOperation,\n      setShowTableHandler,\n      tableHandlerTarget,\n    ]\n  );\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as React from \"react\";\nimport { useCallback, useMemo } from \"react\";\nimport { Th, Thead, Tr } from \"@patternfly/react-table\";\nimport * as _ from \"lodash\";\nimport { Column, ColumnInstance, DataRecord, HeaderGroup, TableInstance } from \"react-table\";\nimport { EditExpressionMenu } from \"../EditExpressionMenu\";\nimport { DataType, TableHeaderVisibility } from \"../../api\";\n// import { DRAWER_SPLITTER_ELEMENT } from \"../Resizer\";\nimport { Resizer } from \"../Resizer\";\n\nexport interface TableHeaderProps {\n  /** Table instance */\n  tableInstance: TableInstance;\n  /** Rows instance */\n  tableRows: React.MutableRefObject<DataRecord[]>;\n  /** Function to be executed when one or more rows are modified */\n  onRowsUpdate: (rows: DataRecord[]) => void;\n  /** Optional label to be used for the edit popover that appears when clicking on column header */\n  editColumnLabel?: string;\n  /** The way in which the header will be rendered */\n  headerVisibility?: TableHeaderVisibility;\n  /** True, for skipping the creation in the DOM of the last defined header group */\n  skipLastHeaderGroup: boolean;\n  /** Custom function for getting column key prop, and avoid using the column index */\n  getColumnKey: (column: Column) => string;\n  /** Columns instance */\n  tableColumns: React.MutableRefObject<Column[]>;\n  /** Function to be executed when columns are modified */\n  onColumnsUpdate: (columns: Column[]) => void;\n}\n\nexport const TableHeader: React.FunctionComponent<TableHeaderProps> = ({\n  tableInstance,\n  tableRows,\n  onRowsUpdate,\n  editColumnLabel,\n  headerVisibility = TableHeaderVisibility.Full,\n  skipLastHeaderGroup,\n  getColumnKey,\n  tableColumns,\n  onColumnsUpdate,\n}) => {\n  const updateColumnNameInRows = useCallback(\n    (prevColumnName: string, newColumnName: string) =>\n      onRowsUpdate(\n        _.map(tableRows.current, (tableCells) => {\n          const assignedCellValue = tableCells[prevColumnName]!;\n          delete tableCells[prevColumnName];\n          tableCells[newColumnName] = assignedCellValue;\n          return tableCells;\n        })\n      ),\n    [onRowsUpdate, tableRows]\n  );\n\n  const onColumnNameOrDataTypeUpdate = useCallback(\n    (columnIndex: number) => {\n      return ({ name = \"\", dataType = DataType.Undefined }) => {\n        const prevColumnName = (tableColumns.current[columnIndex] as ColumnInstance).accessor as string;\n        const updatedTableColumns = [...tableColumns.current] as ColumnInstance[];\n        updatedTableColumns[columnIndex].label = name;\n        updatedTableColumns[columnIndex].accessor = name;\n        updatedTableColumns[columnIndex].dataType = dataType;\n        onColumnsUpdate(updatedTableColumns);\n        if (name !== prevColumnName) {\n          updateColumnNameInRows(prevColumnName, name);\n        }\n      };\n    },\n    [onColumnsUpdate, tableColumns, updateColumnNameInRows]\n  );\n\n  const renderCountColumn = useCallback(\n    (column: ColumnInstance, columnIndex: number) => (\n      <Th\n        {...column.getHeaderProps()}\n        className=\"fixed-column no-clickable-cell\"\n        key={`${getColumnKey(column)}-${columnIndex}`}\n      >\n        <div className=\"header-cell\" data-ouia-component-type=\"expression-column-header\">\n          {column.label}\n        </div>\n      </Th>\n    ),\n    [getColumnKey]\n  );\n\n  const renderHeaderCellInfo = useCallback(\n    (column) => (\n      <div className=\"header-cell-info\" data-ouia-component-type=\"expression-column-header-cell-info\">\n        {column.headerCellElement ? column.headerCellElement : <p className=\"pf-u-text-truncate\">{column.label}</p>}\n        {column.dataType ? <p className=\"pf-u-text-truncate data-type\">({column.dataType})</p> : null}\n      </div>\n    ),\n    []\n  );\n\n  const onHorizontalResizeStop = useCallback((width) => {\n    // console.log(\">>>>>\" + width);\n  }, []);\n\n  const renderResizableHeaderCell = useCallback(\n    (column, columnIndex) => (\n      <Th\n        {...column.getHeaderProps()}\n        {...tableInstance.getThProps(column, columnIndex)}\n        className={`resizable-column ${!column.dataType ? \"no-clickable-cell\" : null}`}\n        key={`${getColumnKey(column)}-${columnIndex}`}\n      >\n        <Resizer width={300} height=\"100%\" minWidth={10} onHorizontalResizeStop={onHorizontalResizeStop}>\n          <div className=\"header-cell\" data-ouia-component-type=\"expression-column-header\">\n            {column.dataType ? (\n              <EditExpressionMenu\n                title={editColumnLabel}\n                selectedExpressionName={column.label}\n                selectedDataType={column.dataType}\n                onExpressionUpdate={onColumnNameOrDataTypeUpdate(columnIndex)}\n                key={`${getColumnKey(column)}-${columnIndex}`}\n              >\n                {renderHeaderCellInfo(column)}\n              </EditExpressionMenu>\n            ) : (\n              renderHeaderCellInfo(column)\n            )}\n          </div>\n        </Resizer>\n      </Th>\n    ),\n    [editColumnLabel, getColumnKey, onColumnNameOrDataTypeUpdate, renderHeaderCellInfo, tableInstance]\n  );\n\n  const renderColumn = useCallback(\n    (column: ColumnInstance, columnIndex: number) =>\n      column.isCountColumn ? renderCountColumn(column, columnIndex) : renderResizableHeaderCell(column, columnIndex),\n    [renderCountColumn, renderResizableHeaderCell]\n  );\n\n  const getHeaderGroups = useCallback(\n    (tableInstance) => {\n      return skipLastHeaderGroup ? _.dropRight(tableInstance.headerGroups) : tableInstance.headerGroups;\n    },\n    [skipLastHeaderGroup]\n  );\n\n  const renderHeaderGroups = useMemo(\n    () =>\n      getHeaderGroups(tableInstance).map((headerGroup: HeaderGroup) => (\n        <Tr key={headerGroup.getHeaderGroupProps().key} {...headerGroup.getHeaderGroupProps()}>\n          {headerGroup.headers.map((column: ColumnInstance, columnIndex: number) => renderColumn(column, columnIndex))}\n        </Tr>\n      )),\n    [getHeaderGroups, renderColumn, tableInstance]\n  );\n\n  const renderAtLevelInHeaderGroups = useCallback(\n    (level: number) => (\n      <Tr>\n        {_.nth(\n          tableInstance.headerGroups as HeaderGroup[],\n          level\n        )!.headers.map((column: ColumnInstance, columnIndex: number) => renderColumn(column, columnIndex))}\n      </Tr>\n    ),\n    [renderColumn, tableInstance.headerGroups]\n  );\n\n  switch (headerVisibility) {\n    case TableHeaderVisibility.Full:\n      return <Thead noWrap>{renderHeaderGroups}</Thead>;\n    case TableHeaderVisibility.LastLevel:\n      return <Thead noWrap>{renderAtLevelInHeaderGroups(-1)}</Thead>;\n    case TableHeaderVisibility.SecondToLastLevel:\n      return <Thead noWrap>{renderAtLevelInHeaderGroups(-2)}</Thead>;\n    default:\n      return null;\n  }\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport \"./Table.css\";\nimport {\n  Column,\n  ColumnInstance,\n  ContextMenuEvent,\n  DataRecord,\n  useBlockLayout,\n  useResizeColumns,\n  useTable,\n} from \"react-table\";\nimport { TableComposable } from \"@patternfly/react-table\";\nimport * as React from \"react\";\nimport { useCallback, useContext, useEffect, useRef, useState } from \"react\";\nimport { EditableCell } from \"./EditableCell\";\nimport { TableOperation, TableProps } from \"../../api\";\nimport * as _ from \"lodash\";\nimport { TableBody } from \"./TableBody\";\nimport { TableHandler } from \"./TableHandler\";\nimport { TableHeader } from \"./TableHeader\";\nimport { BoxedExpressionGlobalContext } from \"../../context\";\n\nexport const NO_TABLE_CONTEXT_MENU_CLASS = \"no-table-context-menu\";\n\nexport const Table: React.FunctionComponent<TableProps> = ({\n  tableId,\n  children,\n  columnPrefix = \"column-\",\n  editColumnLabel,\n  onColumnsUpdate,\n  onRowsUpdate,\n  onRowAdding = () => ({}),\n  defaultCell,\n  rows,\n  columns,\n  handlerConfiguration,\n  headerVisibility,\n  headerLevels = 0,\n  skipLastHeaderGroup = false,\n  getRowKey = (row) => row.id as string,\n  getColumnKey = (column) => column.id as string,\n  resetRowCustomFunction,\n}: TableProps) => {\n  const NUMBER_OF_ROWS_COLUMN = \"#\";\n  const NUMBER_OF_ROWS_SUBCOLUMN = \"0\";\n\n  const tableRef = useRef<HTMLTableElement>(null);\n\n  const globalContext = useContext(BoxedExpressionGlobalContext);\n\n  const generateNumberOfRowsSubColumnRecursively: (column: ColumnInstance, headerLevels: number) => void = (\n    column,\n    headerLevels\n  ) => {\n    if (headerLevels > 0) {\n      _.assign(column, {\n        columns: [\n          {\n            label: NUMBER_OF_ROWS_SUBCOLUMN,\n            accessor: NUMBER_OF_ROWS_SUBCOLUMN,\n            minWidth: 60,\n            width: 60,\n            disableResizing: true,\n            isCountColumn: true,\n            hideFilter: true,\n          },\n        ],\n      });\n\n      generateNumberOfRowsSubColumnRecursively(column.columns[0], headerLevels - 1);\n    }\n  };\n\n  const numberOfRowsColumn = {\n    label: NUMBER_OF_ROWS_COLUMN,\n    accessor: NUMBER_OF_ROWS_COLUMN,\n    width: 60,\n    minWidth: 60,\n    isCountColumn: true,\n  } as ColumnInstance;\n  generateNumberOfRowsSubColumnRecursively(numberOfRowsColumn, headerLevels);\n  const tableColumns = useRef<Column[]>([numberOfRowsColumn, ...columns]);\n  const tableRows = useRef<DataRecord[]>(rows);\n  const [showTableHandler, setShowTableHandler] = useState(false);\n  const [tableHandlerTarget, setTableHandlerTarget] = useState(document.body);\n  const [tableHandlerAllowedOperations, setTableHandlerAllowedOperations] = useState(\n    _.values(TableOperation).map((operation) => parseInt(operation.toString()))\n  );\n  const [lastSelectedColumnIndex, setLastSelectedColumnIndex] = useState(-1);\n  const [lastSelectedRowIndex, setLastSelectedRowIndex] = useState(-1);\n\n  const onColumnsUpdateCallback = useCallback(\n    (columns: Column[]) => {\n      tableColumns.current = columns;\n      onColumnsUpdate?.(columns.slice(1)); //Removing \"# of rows\" column\n    },\n    [onColumnsUpdate]\n  );\n\n  const onRowsUpdateCallback = useCallback(\n    (rows: DataRecord[]) => {\n      tableRows.current = rows;\n      onRowsUpdate?.(rows);\n    },\n    [onRowsUpdate]\n  );\n\n  const onCellUpdate = useCallback(\n    (rowIndex: number, columnId: string, value: string) => {\n      const updatedTableCells = [...tableRows.current];\n      updatedTableCells[rowIndex][columnId] = value;\n      onRowsUpdateCallback(updatedTableCells);\n    },\n    [onRowsUpdateCallback]\n  );\n\n  const onRowUpdate = useCallback(\n    (rowIndex: number, updatedRow: DataRecord) => {\n      const updatedRows = [...tableRows.current];\n      updatedRows[rowIndex] = updatedRow;\n      onRowsUpdateCallback(updatedRows);\n    },\n    [onRowsUpdateCallback]\n  );\n\n  const defaultColumn = {\n    // minWidth: 150,\n    width: \"initial\",\n    Cell: useCallback((cellRef) => {\n      const column = cellRef.column as ColumnInstance;\n      if (column.isCountColumn) {\n        return cellRef.value;\n      } else {\n        return defaultCell ? defaultCell[column.id](cellRef) : EditableCell(cellRef);\n      }\n      // Table performance optimization: no need to re-render cells, since nested component themselves will re-render\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []),\n  };\n\n  const contextMenuIsAvailable = (target: HTMLElement) => {\n    const targetIsContainedInCurrentTable = target.closest(\"table\") === tableRef.current;\n    const contextMenuAvailableForTarget = !target.classList.contains(NO_TABLE_CONTEXT_MENU_CLASS);\n    return targetIsContainedInCurrentTable && contextMenuAvailableForTarget;\n  };\n\n  const tableHandlerStateUpdate = (target: HTMLElement, columnIndex: number) => {\n    setTableHandlerTarget(target);\n    globalContext.currentlyOpenedHandlerCallback?.(false);\n    setShowTableHandler(true);\n    globalContext.setCurrentlyOpenedHandlerCallback?.(() => setShowTableHandler);\n    setLastSelectedColumnIndex(columnIndex);\n  };\n\n  const getThProps = (column: ColumnInstance, columnIndex: number) => ({\n    onContextMenu: (e: ContextMenuEvent) => {\n      const target = e.target as HTMLElement;\n      const handlerOnHeaderIsAvailable = !column.disableHandlerOnHeader;\n      if (contextMenuIsAvailable(target) && handlerOnHeaderIsAvailable) {\n        e.preventDefault();\n        setTableHandlerAllowedOperations([\n          TableOperation.ColumnInsertLeft,\n          TableOperation.ColumnInsertRight,\n          ...(tableColumns.current.length > 2 && columnIndex > 0 ? [TableOperation.ColumnDelete] : []),\n        ]);\n        tableHandlerStateUpdate(target, columnIndex);\n      }\n    },\n  });\n\n  const getTdProps = (columnIndex: number, rowIndex: number) => ({\n    onContextMenu: (e: ContextMenuEvent) => {\n      const target = e.target as HTMLElement;\n      if (contextMenuIsAvailable(target)) {\n        e.preventDefault();\n        setTableHandlerAllowedOperations([\n          TableOperation.ColumnInsertLeft,\n          TableOperation.ColumnInsertRight,\n          ...(tableColumns.current.length > 2 && columnIndex > 0 ? [TableOperation.ColumnDelete] : []),\n          TableOperation.RowInsertAbove,\n          TableOperation.RowInsertBelow,\n          ...(tableRows.current.length > 1 ? [TableOperation.RowDelete] : []),\n          TableOperation.RowClear,\n        ]);\n        tableHandlerStateUpdate(target, columnIndex);\n        setLastSelectedRowIndex(rowIndex);\n      }\n    },\n  });\n\n  const tableInstance = useTable(\n    {\n      columns: tableColumns.current,\n      data: tableRows.current,\n      defaultColumn,\n      onCellUpdate,\n      onRowUpdate,\n      getThProps,\n      getTdProps,\n    },\n    useBlockLayout,\n    useResizeColumns\n  );\n\n  const resizeNestedColumns = (columns: ColumnInstance[], accessor: string, updatedWidth: number) => {\n    const columnIndex = _.findIndex(columns, { accessor });\n    if (columnIndex >= 0) {\n      const updatedColumn = { ...columns[columnIndex] };\n      updatedColumn.width = updatedWidth;\n      columns.splice(columnIndex, 1, updatedColumn);\n    } else {\n      _.forEach(columns, (column) => resizeNestedColumns(column.columns, accessor, updatedWidth));\n    }\n  };\n\n  const finishedResizing =\n    tableInstance.state.columnResizing.isResizingColumn === null &&\n    !_.isEmpty(tableInstance.state.columnResizing.columnWidths);\n  useEffect(() => {\n    if (finishedResizing) {\n      _.forEach(tableInstance.state.columnResizing.columnWidths, (updatedColumnWidth, accessor) =>\n        resizeNestedColumns(tableColumns.current as ColumnInstance[], accessor, updatedColumnWidth)\n      );\n      onColumnsUpdateCallback(tableColumns.current);\n    }\n    // Need to consider a change only when resizing is finished (no other dependencies to consider for this useEffect)\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [finishedResizing]);\n\n  return (\n    <div className={`table-component ${tableId}`}>\n      <TableComposable variant=\"compact\" {...tableInstance.getTableProps()} ref={tableRef}>\n        <TableHeader\n          tableInstance={tableInstance}\n          editColumnLabel={editColumnLabel}\n          headerVisibility={headerVisibility}\n          skipLastHeaderGroup={skipLastHeaderGroup}\n          tableRows={tableRows}\n          onRowsUpdate={onRowsUpdateCallback}\n          tableColumns={tableColumns}\n          getColumnKey={getColumnKey}\n          onColumnsUpdate={onColumnsUpdateCallback}\n        />\n        <TableBody\n          tableInstance={tableInstance}\n          getRowKey={getRowKey}\n          getColumnKey={getColumnKey}\n          headerVisibility={headerVisibility}\n        >\n          {children}\n        </TableBody>\n      </TableComposable>\n      {showTableHandler ? (\n        <TableHandler\n          tableColumns={tableColumns}\n          columnPrefix={columnPrefix}\n          handlerConfiguration={handlerConfiguration}\n          lastSelectedColumnIndex={lastSelectedColumnIndex}\n          lastSelectedRowIndex={lastSelectedRowIndex}\n          tableRows={tableRows}\n          onRowsUpdate={onRowsUpdateCallback}\n          onRowAdding={onRowAdding}\n          showTableHandler={showTableHandler}\n          setShowTableHandler={setShowTableHandler}\n          tableHandlerAllowedOperations={tableHandlerAllowedOperations}\n          tableHandlerTarget={tableHandlerTarget}\n          resetRowCustomFunction={resetRowCustomFunction}\n          onColumnsUpdate={onColumnsUpdateCallback}\n        />\n      ) : null}\n    </div>\n  );\n};\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as React from \"react\";\nimport { ChangeEvent, useCallback, useEffect } from \"react\";\nimport { CellProps } from \"../../api\";\n\nexport interface EditableCellProps extends CellProps {\n  /** Cell's value */\n  value: string;\n  /** Function executed each time a cell gets updated */\n  onCellUpdate: (rowIndex: number, columnId: string, value: string) => void;\n}\n\nexport const EditableCell: React.FunctionComponent<EditableCellProps> = ({\n  value: initialValue,\n  row: { index },\n  column: { id },\n  onCellUpdate,\n}: EditableCellProps) => {\n  const [value, setValue] = React.useState(initialValue);\n\n  useEffect(() => {\n    setValue(initialValue);\n  }, [initialValue]);\n\n  const onChange = useCallback((e: ChangeEvent<HTMLTextAreaElement>) => {\n    setValue(e.target.value);\n  }, []);\n\n  const onBlur = useCallback(() => {\n    onCellUpdate(index, id, value);\n  }, [id, index, value, onCellUpdate]);\n\n  return <textarea value={value || \"\"} onChange={onChange} onBlur={onBlur} />;\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport \"./RelationExpression.css\";\nimport * as React from \"react\";\nimport { useCallback, useEffect, useRef } from \"react\";\nimport \"@patternfly/patternfly/utilities/Text/text.css\";\nimport { Column as RelationColumn, DataType, RelationProps, Row, TableOperation } from \"../../api\";\nimport { Table } from \"../Table\";\nimport { useBoxedExpressionEditorI18n } from \"../../i18n\";\nimport * as _ from \"lodash\";\nimport { Column, ColumnInstance, DataRecord } from \"react-table\";\n\nexport const RelationExpression: React.FunctionComponent<RelationProps> = (relationProps: RelationProps) => {\n  const FIRST_COLUMN_NAME = \"column-1\";\n  const { i18n } = useBoxedExpressionEditorI18n();\n\n  const handlerConfiguration = [\n    {\n      group: i18n.columns,\n      items: [\n        { name: i18n.columnOperations.insertLeft, type: TableOperation.ColumnInsertLeft },\n        { name: i18n.columnOperations.insertRight, type: TableOperation.ColumnInsertRight },\n        { name: i18n.columnOperations.delete, type: TableOperation.ColumnDelete },\n      ],\n    },\n    {\n      group: i18n.rows,\n      items: [\n        { name: i18n.rowOperations.insertAbove, type: TableOperation.RowInsertAbove },\n        { name: i18n.rowOperations.insertBelow, type: TableOperation.RowInsertBelow },\n        { name: i18n.rowOperations.delete, type: TableOperation.RowDelete },\n      ],\n    },\n  ];\n\n  const tableColumns = useRef<RelationColumn[]>(\n    relationProps.columns === undefined\n      ? [{ name: FIRST_COLUMN_NAME, dataType: DataType.Undefined }]\n      : relationProps.columns\n  );\n\n  const tableRows = useRef<Row[]>(relationProps.rows === undefined ? [[\"\"]] : relationProps.rows);\n\n  const spreadRelationExpressionDefinition = useCallback(() => {\n    const expressionDefinition = {\n      ...relationProps,\n      columns: tableColumns.current,\n      rows: tableRows.current,\n    };\n    relationProps.isHeadless\n      ? relationProps.onUpdatingRecursiveExpression?.(expressionDefinition)\n      : window.beeApi?.broadcastRelationExpressionDefinition?.(expressionDefinition);\n  }, [relationProps]);\n\n  const convertColumnsForTheTable = useCallback(\n    () =>\n      _.map(\n        tableColumns.current,\n        (column: RelationColumn) =>\n          ({\n            label: column.name,\n            accessor: column.name,\n            dataType: column.dataType,\n          } as Column)\n      ),\n    []\n  );\n\n  const convertRowsForTheTable = useCallback(\n    () =>\n      _.map(tableRows.current, (row) =>\n        _.reduce(\n          tableColumns.current,\n          (tableRow: DataRecord, column, columnIndex) => {\n            tableRow[column.name] = row[columnIndex] || \"\";\n            return tableRow;\n          },\n          {}\n        )\n      ),\n    []\n  );\n\n  const onSavingRows = useCallback(\n    (rows: DataRecord[]) => {\n      tableRows.current = _.map(rows, (tableRow: DataRecord) =>\n        _.reduce(\n          tableColumns.current,\n          (row: string[], column: RelationColumn) => {\n            row.push((tableRow[column.name]! as string) || \"\");\n            return row;\n          },\n          []\n        )\n      );\n      spreadRelationExpressionDefinition();\n    },\n    [spreadRelationExpressionDefinition]\n  );\n\n  const onSavingColumns = useCallback(\n    (columns) => {\n      tableColumns.current = _.map(columns, (columnInstance: ColumnInstance) => ({\n        name: columnInstance.accessor,\n        dataType: columnInstance.dataType,\n        // width: columnInstance.width,\n      }));\n      spreadRelationExpressionDefinition();\n    },\n    [spreadRelationExpressionDefinition]\n  );\n\n  useEffect(() => {\n    /** Function executed only the first time the component is loaded */\n    spreadRelationExpressionDefinition();\n  }, [spreadRelationExpressionDefinition]);\n\n  return (\n    <div className=\"relation-expression\">\n      <Table\n        columnPrefix=\"column-\"\n        editColumnLabel={i18n.editRelation}\n        columns={convertColumnsForTheTable()}\n        rows={convertRowsForTheTable()}\n        onColumnsUpdate={onSavingColumns}\n        onRowsUpdate={onSavingRows}\n        handlerConfiguration={handlerConfiguration}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ExpressionProps, LogicType } from \"../../api\";\nimport * as React from \"react\";\nimport { useCallback, useEffect, useRef } from \"react\";\nimport { LogicTypeSelector } from \"../LogicTypeSelector\";\nimport * as _ from \"lodash\";\nimport { Resizer } from \"../Resizer\";\n\nexport interface ContextEntryExpressionProps {\n  /** The expression wrapped by the entry */\n  expression: ExpressionProps;\n  /** Function invoked when updating expression */\n  onUpdatingRecursiveExpression: (expression: ExpressionProps) => void;\n  /** Function invoked when resetting expression */\n  onExpressionResetting?: () => void;\n}\n\nexport const ContextEntryExpression: React.FunctionComponent<ContextEntryExpressionProps> = ({\n  expression,\n  onUpdatingRecursiveExpression,\n  onExpressionResetting,\n}) => {\n  const expressionContainerRef = useRef<HTMLDivElement>(null);\n\n  const entryExpression = useRef(expression);\n\n  const expressionChangedExternally = expression.logicType === undefined;\n  useEffect(() => {\n    entryExpression.current = _.omit(expression, \"isHeadless\");\n    // Every time, for an expression, its logic type is undefined, it means that corresponding entry has been just added\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [expressionChangedExternally]);\n\n  const getLogicTypeSelectorRef = useCallback(() => {\n    return expressionContainerRef.current!;\n  }, []);\n\n  const onLogicTypeUpdating = useCallback(\n    (logicType) => {\n      entryExpression.current.logicType = logicType;\n      onUpdatingRecursiveExpression(_.omit(entryExpression.current, \"isHeadless\"));\n    },\n    [onUpdatingRecursiveExpression]\n  );\n\n  const onLogicTypeResetting = useCallback(() => {\n    entryExpression.current.logicType = LogicType.Undefined;\n    onExpressionResetting?.();\n    onUpdatingRecursiveExpression(_.omit(entryExpression.current, \"isHeadless\"));\n  }, [onExpressionResetting, onUpdatingRecursiveExpression]);\n\n  const onHorizontalResizeStop = useCallback((width) => {\n    // console.log(\">>>>>\" + width);\n  }, []);\n\n  return (\n    <Resizer width={300} height=\"100%\" minWidth={10} onHorizontalResizeStop={onHorizontalResizeStop}>\n      <div className=\"entry-expression\" ref={expressionContainerRef}>\n        <LogicTypeSelector\n          isHeadless={true}\n          onUpdatingRecursiveExpression={onUpdatingRecursiveExpression}\n          selectedExpression={entryExpression.current}\n          onLogicTypeUpdating={onLogicTypeUpdating}\n          onLogicTypeResetting={onLogicTypeResetting}\n          getPlacementRef={getLogicTypeSelectorRef}\n        />\n      </div>\n    </Resizer>\n  );\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport \"./ContextEntryExpressionCell.css\";\nimport * as React from \"react\";\nimport { useCallback, useEffect, useRef } from \"react\";\nimport { CellProps, ContextEntries, ExpressionProps } from \"../../api\";\nimport { DataRecord } from \"react-table\";\nimport { ContextEntryExpression } from \"./ContextEntryExpression\";\n// import { Resizer } from \"../Resizer\";\n\nexport interface ContextEntryExpressionCellProps extends CellProps {\n  data: ContextEntries;\n  onRowUpdate: (rowIndex: number, updatedRow: DataRecord) => void;\n}\n\nexport const ContextEntryExpressionCell: React.FunctionComponent<ContextEntryExpressionCellProps> = ({\n  data,\n  row: { index },\n  onRowUpdate,\n}) => {\n  const contextEntry = data[index];\n\n  const entryExpression = useRef({\n    uid: contextEntry.entryExpression.uid,\n    ...contextEntry.entryExpression,\n  } as ExpressionProps);\n\n  const expressionChangedExternally = contextEntry.entryExpression.logicType === undefined;\n  useEffect(() => {\n    entryExpression.current = contextEntry.entryExpression;\n    onRowUpdate(index, { ...contextEntry, entryExpression: entryExpression.current });\n    // Every time, for an expression, its logic type is undefined, it means that corresponding entry has been just added\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [expressionChangedExternally]);\n\n  const onUpdatingRecursiveExpression = useCallback((expression: ExpressionProps) => {\n    entryExpression.current = expression;\n    onRowUpdate(index, { ...contextEntry, entryExpression: expression });\n    // Callback should never change\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // const onHorizontalResizeStop = useCallback((width) => {\n  //   console.log(\">>>>>\" + width);\n  // }, []);\n\n  return (\n    // <Resizer width={200} height=\"100%\" minWidth={10} onHorizontalResizeStop={onHorizontalResizeStop}>\n    <div className=\"context-entry-expression-cell\">\n      <ContextEntryExpression\n        expression={entryExpression.current}\n        onUpdatingRecursiveExpression={onUpdatingRecursiveExpression}\n        onExpressionResetting={contextEntry.onExpressionResetting}\n      />\n    </div>\n    // </Resizer>\n  );\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport \"./ContextEntryInfo.css\";\nimport * as React from \"react\";\nimport { useCallback, useEffect, useState } from \"react\";\nimport { EditExpressionMenu } from \"../EditExpressionMenu\";\nimport { DataType } from \"../../api\";\nimport { Resizer } from \"../Resizer\";\n\nexport interface ContextEntryInfoProps {\n  /** Context Entry info name */\n  name: string;\n  /** Context Entry info dataType */\n  dataType: DataType;\n  /** Callback to be executed when name or dataType get updated */\n  onContextEntryUpdate: (name: string, dataType: DataType) => void;\n  /** Label used for the popover triggered when editing info section */\n  editInfoPopoverLabel: string;\n}\n\nexport const ContextEntryInfo: React.FunctionComponent<ContextEntryInfoProps> = ({\n  name,\n  dataType,\n  onContextEntryUpdate,\n  editInfoPopoverLabel,\n}) => {\n  const [entryName, setEntryName] = useState(name);\n\n  const [entryDataType, setEntryDataType] = useState(dataType);\n\n  useEffect(() => {\n    setEntryName(name);\n  }, [name]);\n\n  useEffect(() => {\n    setEntryDataType(dataType);\n  }, [dataType]);\n\n  const onEntryNameOrDataTypeUpdate = useCallback(\n    ({ name, dataType }) => {\n      setEntryName(name);\n      setEntryDataType(dataType);\n      onContextEntryUpdate(name, dataType);\n    },\n    [onContextEntryUpdate]\n  );\n\n  return (\n    <div className=\"entry-info\">\n      <EditExpressionMenu\n        title={editInfoPopoverLabel}\n        selectedExpressionName={entryName}\n        selectedDataType={entryDataType}\n        onExpressionUpdate={onEntryNameOrDataTypeUpdate}\n      >\n        <div className=\"entry-definition\">\n          <p className=\"entry-name pf-u-text-truncate\" title={entryName}>\n            {entryName}\n          </p>\n          <p className=\"entry-data-type pf-u-text-truncate\" title={entryDataType}>\n            ({entryDataType})\n          </p>\n        </div>\n      </EditExpressionMenu>\n    </div>\n  );\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { CellProps, ContextEntries } from \"../../api\";\nimport * as React from \"react\";\nimport { useCallback, useEffect, useState } from \"react\";\nimport { DataRecord } from \"react-table\";\nimport { ContextEntryInfo } from \"./ContextEntryInfo\";\n\nexport interface ContextEntryInfoCellProps extends CellProps {\n  data: ContextEntries;\n  onRowUpdate: (rowIndex: number, updatedRow: DataRecord) => void;\n}\n\nexport const ContextEntryInfoCell: React.FunctionComponent<ContextEntryInfoCellProps> = ({\n  data,\n  row: { index },\n  onRowUpdate,\n}) => {\n  const contextEntry = data[index];\n\n  const [entryInfo, setEntryInfo] = useState(contextEntry.entryInfo);\n\n  useEffect(() => {\n    setEntryInfo(contextEntry.entryInfo);\n  }, [contextEntry.entryInfo]);\n\n  const onContextEntryUpdate = useCallback(\n    (name, dataType) => {\n      onRowUpdate(index, { ...contextEntry, entryInfo: { name, dataType } });\n    },\n    [contextEntry, index, onRowUpdate]\n  );\n\n  return (\n    <div className=\"context-entry-info-cell\">\n      <ContextEntryInfo\n        name={entryInfo.name}\n        dataType={entryInfo.dataType}\n        onContextEntryUpdate={onContextEntryUpdate}\n        editInfoPopoverLabel={contextEntry.editInfoPopoverLabel}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport \"./ContextExpression.css\";\nimport * as React from \"react\";\nimport { useCallback, useEffect, useState } from \"react\";\nimport {\n  ContextEntries,\n  ContextProps,\n  DataType,\n  DEFAULT_ENTRY_EXPRESSION_MIN_WIDTH,\n  DEFAULT_ENTRY_INFO_MIN_WIDTH,\n  ExpressionProps,\n  generateNextAvailableEntryName,\n  getEntryKey,\n  getHandlerConfiguration,\n  LogicType,\n  resetEntry,\n  TableHeaderVisibility,\n} from \"../../api\";\nimport { Table } from \"../Table\";\nimport { useBoxedExpressionEditorI18n } from \"../../i18n\";\nimport { ColumnInstance, DataRecord } from \"react-table\";\nimport { ContextEntryExpressionCell } from \"./ContextEntryExpressionCell\";\nimport * as _ from \"lodash\";\nimport { ContextEntryExpression } from \"./ContextEntryExpression\";\nimport { ContextEntryInfoCell } from \"./ContextEntryInfoCell\";\nimport { Resizer } from \"../Resizer\";\n\nconst DEFAULT_CONTEXT_ENTRY_NAME = \"ContextEntry-1\";\nconst DEFAULT_CONTEXT_ENTRY_DATA_TYPE = DataType.Undefined;\n\nexport const ContextExpression: React.FunctionComponent<ContextProps> = ({\n  uid,\n  name = DEFAULT_CONTEXT_ENTRY_NAME,\n  dataType = DEFAULT_CONTEXT_ENTRY_DATA_TYPE,\n  onUpdatingNameAndDataType,\n  contextEntries,\n  result = {} as ExpressionProps,\n  entryInfoWidth = DEFAULT_ENTRY_INFO_MIN_WIDTH,\n  entryExpressionWidth = DEFAULT_ENTRY_EXPRESSION_MIN_WIDTH,\n  isHeadless = false,\n  onUpdatingRecursiveExpression,\n}) => {\n  const { i18n } = useBoxedExpressionEditorI18n();\n\n  const [resultExpression, setResultExpression] = useState(result);\n  const [infoWidth, setInfoWidth] = useState(entryInfoWidth);\n  const [expressionWidth, setExpressionWidth] = useState(entryExpressionWidth);\n\n  const [columns, setColumns] = useState([\n    {\n      label: name,\n      accessor: name,\n      dataType,\n      disableHandlerOnHeader: true,\n      columns: [\n        {\n          // label: \"Name\",\n          accessor: \"entryInfo\",\n          disableHandlerOnHeader: true,\n          width: \"initial\",\n          // minWidth: DEFAULT_ENTRY_INFO_MIN_WIDTH,\n        },\n        {\n          // label: \"Value\",\n          accessor: \"entryExpression\",\n          disableHandlerOnHeader: true,\n          width: \"initial\",\n          // minWidth: DEFAULT_ENTRY_EXPRESSION_MIN_WIDTH,\n        },\n      ],\n    },\n  ]);\n\n  const [rows, setRows] = useState(\n    contextEntries || [\n      {\n        entryInfo: {\n          name: DEFAULT_CONTEXT_ENTRY_NAME,\n          dataType: DEFAULT_CONTEXT_ENTRY_DATA_TYPE,\n        },\n        entryExpression: {},\n        editInfoPopoverLabel: i18n.editContextEntry,\n      } as DataRecord,\n    ]\n  );\n\n  const onColumnsUpdate = useCallback(\n    ([expressionColumn]: [ColumnInstance]) => {\n      onUpdatingNameAndDataType?.(expressionColumn.label, expressionColumn.dataType);\n      setExpressionWidth(_.find(expressionColumn.columns, { accessor: \"entryExpression\" })?.width as number);\n      setInfoWidth(_.find(expressionColumn.columns, { accessor: \"entryInfo\" })?.width as number);\n      setColumns(([prevExpressionColumn]) => [\n        {\n          ...prevExpressionColumn,\n          label: expressionColumn.label,\n          accessor: expressionColumn.accessor,\n          dataType: expressionColumn.dataType,\n        },\n      ]);\n    },\n    [onUpdatingNameAndDataType]\n  );\n\n  const onRowAdding = useCallback(\n    () => ({\n      entryInfo: {\n        name: generateNextAvailableEntryName(rows as ContextEntries, \"ContextEntry\"),\n        dataType: DataType.Undefined,\n      },\n      entryExpression: {},\n      editInfoPopoverLabel: i18n.editContextEntry,\n    }),\n    [i18n.editContextEntry, rows]\n  );\n\n  const getHeaderVisibility = useCallback(() => {\n    return isHeadless ? TableHeaderVisibility.None : TableHeaderVisibility.SecondToLastLevel;\n  }, [isHeadless]);\n\n  const onHorizontalResizeStop = useCallback((width) => {\n    // console.log(\">>>>>\" + width);\n  }, []);\n\n  useEffect(() => {\n    const [expressionColumn] = columns;\n    const updatedDefinition: ContextProps = {\n      uid,\n      logicType: LogicType.Context,\n      name: expressionColumn.accessor,\n      dataType: expressionColumn.dataType,\n      contextEntries: rows as ContextEntries,\n      result: _.omit(resultExpression, \"isHeadless\"),\n      ...(infoWidth > DEFAULT_ENTRY_INFO_MIN_WIDTH ? { entryInfoWidth: infoWidth } : {}),\n      ...(expressionWidth > DEFAULT_ENTRY_EXPRESSION_MIN_WIDTH ? { entryExpressionWidth: expressionWidth } : {}),\n    };\n    isHeadless\n      ? onUpdatingRecursiveExpression?.(_.omit(updatedDefinition, [\"name\", \"dataType\"]))\n      : window.beeApi?.broadcastContextExpressionDefinition?.(updatedDefinition);\n  }, [columns, isHeadless, onUpdatingRecursiveExpression, rows, resultExpression, infoWidth, expressionWidth, uid]);\n\n  return (\n    <div className={`context-expression ${uid}`}>\n      <Table\n        tableId={uid}\n        headerLevels={1}\n        headerVisibility={getHeaderVisibility()}\n        defaultCell={{ entryInfo: ContextEntryInfoCell, entryExpression: ContextEntryExpressionCell }}\n        columns={columns}\n        rows={rows as DataRecord[]}\n        onColumnsUpdate={onColumnsUpdate}\n        onRowAdding={onRowAdding}\n        onRowsUpdate={setRows}\n        handlerConfiguration={getHandlerConfiguration(i18n, i18n.contextEntry)}\n        getRowKey={useCallback(getEntryKey, [])}\n        resetRowCustomFunction={useCallback(resetEntry, [])}\n      >\n        <Resizer width={300} height=\"100%\" minWidth={10} onHorizontalResizeStop={onHorizontalResizeStop}>\n          <div className=\"context-result\">{`<result>`}</div>\n        </Resizer>\n        <ContextEntryExpression expression={resultExpression} onUpdatingRecursiveExpression={setResultExpression} />\n      </Table>\n    </div>\n  );\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DecisionTableProps } from \"../../api\";\nimport * as React from \"react\";\n\nexport const DecisionTableExpression: React.FunctionComponent<DecisionTableProps> = () => {\n  return <div>Decision Table</div>;\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport \"./ListExpression.css\";\nimport * as React from \"react\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport {\n  ContextEntryRecord,\n  ExpressionProps,\n  ListProps,\n  LiteralExpressionProps,\n  LogicType,\n  TableHandlerConfiguration,\n  TableHeaderVisibility,\n  TableOperation,\n} from \"../../api\";\nimport { ContextEntryExpressionCell } from \"../ContextExpression\";\nimport { Table } from \"../Table\";\nimport { useBoxedExpressionEditorI18n } from \"../../i18n\";\nimport { DataRecord, Row } from \"react-table\";\nimport * as _ from \"lodash\";\nimport { Resizer } from \"../Resizer\";\n\nconst LIST_EXPRESSION_MIN_WIDTH = 430;\n\nexport const ListExpression: React.FunctionComponent<ListProps> = ({\n  isHeadless,\n  items,\n  onUpdatingRecursiveExpression,\n  uid,\n  width = LIST_EXPRESSION_MIN_WIDTH,\n}: ListProps) => {\n  const { i18n } = useBoxedExpressionEditorI18n();\n\n  const handlerConfiguration: TableHandlerConfiguration = [\n    {\n      group: i18n.rows,\n      items: [\n        { name: i18n.rowOperations.insertAbove, type: TableOperation.RowInsertAbove },\n        { name: i18n.rowOperations.insertBelow, type: TableOperation.RowInsertBelow },\n        { name: i18n.rowOperations.delete, type: TableOperation.RowDelete },\n        { name: i18n.rowOperations.clear, type: TableOperation.RowClear },\n      ],\n    },\n  ];\n\n  const generateLiteralExpression = () => ({ logicType: LogicType.LiteralExpression } as LiteralExpressionProps);\n\n  const [listItems, setListItems] = useState(\n    _.isEmpty(items)\n      ? [\n          {\n            entryExpression: generateLiteralExpression(),\n          } as DataRecord,\n        ]\n      : _.map(items, (item) => ({ entryExpression: item } as DataRecord))\n  );\n\n  const listExpressionWidth = useRef(width);\n\n  const listTableGetRowKey = useCallback((row: Row) => (row.original as ContextEntryRecord).entryExpression.uid!, []);\n\n  const onRowAdding = useCallback(\n    () => ({\n      entryExpression: generateLiteralExpression(),\n    }),\n    []\n  );\n\n  const spreadListExpressionDefinition = useCallback(() => {\n    const updatedDefinition: ListProps = {\n      uid,\n      ...(listExpressionWidth.current !== LIST_EXPRESSION_MIN_WIDTH ? { width: listExpressionWidth.current } : {}),\n      logicType: LogicType.List,\n      items: _.map(listItems, (listItem: DataRecord) => listItem.entryExpression as ExpressionProps),\n    };\n    isHeadless\n      ? onUpdatingRecursiveExpression?.(updatedDefinition)\n      : window.beeApi?.broadcastListExpressionDefinition?.(updatedDefinition);\n  }, [isHeadless, listItems, onUpdatingRecursiveExpression, uid]);\n\n  const onRowsUpdate = useCallback((rows) => {\n    setListItems(rows);\n  }, []);\n\n  const resetRowCustomFunction = useCallback((row: DataRecord) => {\n    return { entryExpression: { uid: (row.entryExpression as ExpressionProps).uid } };\n  }, []);\n\n  const onHorizontalResizeStop = useCallback(\n    (width) => {\n      listExpressionWidth.current = width;\n      spreadListExpressionDefinition();\n    },\n    [spreadListExpressionDefinition]\n  );\n\n  useEffect(() => {\n    /** Everytime the list of items changes, we need to spread expression's updated definition */\n    spreadListExpressionDefinition();\n  }, [listItems, spreadListExpressionDefinition]);\n\n  return (\n    <div className=\"list-expression\">\n      <Resizer\n        width={listExpressionWidth.current}\n        height=\"100%\"\n        minWidth={LIST_EXPRESSION_MIN_WIDTH}\n        onHorizontalResizeStop={onHorizontalResizeStop}\n      >\n        <Table\n          tableId={uid}\n          headerVisibility={TableHeaderVisibility.None}\n          defaultCell={{ list: ContextEntryExpressionCell }}\n          columns={[{ accessor: \"list\", width: \"100%\" }]}\n          rows={listItems as DataRecord[]}\n          onRowsUpdate={onRowsUpdate}\n          onRowAdding={onRowAdding}\n          handlerConfiguration={handlerConfiguration}\n          getRowKey={listTableGetRowKey}\n          resetRowCustomFunction={resetRowCustomFunction}\n        />\n      </Resizer>\n    </div>\n  );\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport \"./InvocationExpression.css\";\nimport * as React from \"react\";\nimport { ChangeEvent, useCallback, useEffect, useRef, useState } from \"react\";\nimport {\n  ContextEntries,\n  DataType,\n  DEFAULT_ENTRY_EXPRESSION_MIN_WIDTH,\n  DEFAULT_ENTRY_INFO_MIN_WIDTH,\n  generateNextAvailableEntryName,\n  getEntryKey,\n  getHandlerConfiguration,\n  InvocationProps,\n  resetEntry,\n  TableHeaderVisibility,\n} from \"../../api\";\nimport { Table } from \"../Table\";\nimport { useBoxedExpressionEditorI18n } from \"../../i18n\";\nimport { ColumnInstance, DataRecord } from \"react-table\";\nimport { ContextEntryExpressionCell, ContextEntryInfoCell } from \"../ContextExpression\";\nimport * as _ from \"lodash\";\nimport { Resizer } from \"../Resizer\";\n\nconst DEFAULT_PARAMETER_NAME = \"p-1\";\nconst DEFAULT_PARAMETER_DATA_TYPE = DataType.Undefined;\n\nexport const InvocationExpression: React.FunctionComponent<InvocationProps> = ({\n  bindingEntries,\n  dataType = DEFAULT_PARAMETER_DATA_TYPE,\n  entryInfoWidth = DEFAULT_ENTRY_INFO_MIN_WIDTH,\n  entryExpressionWidth = DEFAULT_ENTRY_EXPRESSION_MIN_WIDTH,\n  invokedFunction = \"\",\n  isHeadless,\n  logicType,\n  name = DEFAULT_PARAMETER_NAME,\n  onUpdatingNameAndDataType,\n  onUpdatingRecursiveExpression,\n  uid,\n}: InvocationProps) => {\n  const { i18n } = useBoxedExpressionEditorI18n();\n\n  const [rows, setRows] = useState(\n    bindingEntries || [\n      {\n        entryInfo: {\n          name: DEFAULT_PARAMETER_NAME,\n          dataType: DEFAULT_PARAMETER_DATA_TYPE,\n        },\n        entryExpression: {},\n        editInfoPopoverLabel: i18n.editParameter,\n      } as DataRecord,\n    ]\n  );\n\n  const functionDefinition = useRef<string>(invokedFunction);\n\n  const infoWidth = useRef<number>(entryInfoWidth);\n\n  const expressionWidth = useRef<number>(entryExpressionWidth);\n\n  const spreadInvocationExpressionDefinition = useCallback(() => {\n    const [expressionColumn] = columns.current;\n\n    const updatedDefinition: InvocationProps = {\n      uid,\n      logicType,\n      name: expressionColumn.accessor,\n      dataType: expressionColumn.dataType,\n      bindingEntries: rows as ContextEntries,\n      invokedFunction: functionDefinition.current,\n      // ...(infoWidth.current > DEFAULT_ENTRY_INFO_MIN_WIDTH ? { entryInfoWidth: infoWidth.current } : {}),\n      ...(expressionWidth.current > DEFAULT_ENTRY_EXPRESSION_MIN_WIDTH\n        ? { entryExpressionWidth: expressionWidth.current }\n        : {}),\n    };\n    isHeadless\n      ? onUpdatingRecursiveExpression?.(_.omit(updatedDefinition, [\"name\", \"dataType\"]))\n      : window.beeApi?.broadcastInvocationExpressionDefinition?.(updatedDefinition);\n  }, [functionDefinition, isHeadless, logicType, onUpdatingRecursiveExpression, rows, uid]);\n\n  const onFunctionDefinitionChange = useCallback((e: ChangeEvent<HTMLInputElement>) => {\n    functionDefinition.current = e.target.value;\n  }, []);\n\n  const onFunctionDefinitionBlur = useCallback(() => {\n    spreadInvocationExpressionDefinition();\n  }, [spreadInvocationExpressionDefinition]);\n\n  const onHorizontalResizeStop = useCallback((width) => {\n    // console.log(\">>>>>\" + width);\n  }, []);\n\n  const headerCellElement = (\n    <Resizer width={200} height=\"100%\" minWidth={10} onHorizontalResizeStop={onHorizontalResizeStop}>\n      <div className=\"function-definition-container\">\n        <input\n          className=\"function-definition pf-u-text-truncate\"\n          type=\"text\"\n          placeholder={i18n.enterFunction}\n          onChange={onFunctionDefinitionChange}\n          onBlur={onFunctionDefinitionBlur}\n          defaultValue={functionDefinition.current}\n        />\n      </div>\n    </Resizer>\n  );\n\n  const columns = useRef<ColumnInstance[]>([\n    {\n      label: name,\n      accessor: name,\n      dataType,\n      disableHandlerOnHeader: true,\n      columns: [\n        {\n          headerCellElement,\n          accessor: \"functionDefinition\",\n          disableHandlerOnHeader: true,\n          columns: [\n            {\n              accessor: \"entryInfo\",\n              disableHandlerOnHeader: true,\n              width: \"inital\",\n              // minWidth: DEFAULT_ENTRY_INFO_MIN_WIDTH,\n            },\n            {\n              accessor: \"entryExpression\",\n              disableHandlerOnHeader: true,\n              width: \"inital\",\n              // minWidth: DEFAULT_ENTRY_EXPRESSION_MIN_WIDTH,\n            },\n          ],\n        },\n      ],\n    },\n  ] as ColumnInstance[]);\n\n  const onColumnsUpdate = useCallback(\n    ([expressionColumn]: [ColumnInstance]) => {\n      onUpdatingNameAndDataType?.(expressionColumn.label, expressionColumn.dataType);\n      // infoWidth.current = _.find(expressionColumn.columns, { accessor: \"entryInfo\" })?.width as number;\n      // expressionWidth.current = _.find(expressionColumn.columns, { accessor: \"entryExpression\" })?.width as number;\n      const [updatedExpressionColumn] = columns.current;\n      updatedExpressionColumn.label = expressionColumn.label;\n      updatedExpressionColumn.accessor = expressionColumn.accessor;\n      updatedExpressionColumn.dataType = expressionColumn.dataType;\n      spreadInvocationExpressionDefinition();\n    },\n    [onUpdatingNameAndDataType, spreadInvocationExpressionDefinition]\n  );\n\n  const onRowAdding = useCallback(\n    () => ({\n      entryInfo: {\n        name: generateNextAvailableEntryName(rows as ContextEntries, \"p\"),\n        dataType: DEFAULT_PARAMETER_DATA_TYPE,\n      },\n      entryExpression: {},\n      editInfoPopoverLabel: i18n.editParameter,\n    }),\n    [i18n.editParameter, rows]\n  );\n\n  const getHeaderVisibility = useCallback(() => {\n    return isHeadless ? TableHeaderVisibility.SecondToLastLevel : TableHeaderVisibility.Full;\n  }, [isHeadless]);\n\n  useEffect(() => {\n    /** Everytime the list of items or the function definition change, we need to spread expression's updated definition */\n    spreadInvocationExpressionDefinition();\n  }, [rows, spreadInvocationExpressionDefinition]);\n\n  return (\n    <div className={`invocation-expression ${uid}`}>\n      <Table\n        tableId={uid}\n        headerLevels={2}\n        headerVisibility={getHeaderVisibility()}\n        skipLastHeaderGroup\n        defaultCell={{ entryInfo: ContextEntryInfoCell, entryExpression: ContextEntryExpressionCell }}\n        columns={columns.current}\n        rows={rows as DataRecord[]}\n        onColumnsUpdate={onColumnsUpdate}\n        onRowAdding={onRowAdding}\n        onRowsUpdate={setRows}\n        handlerConfiguration={getHandlerConfiguration(i18n, i18n.parameters)}\n        getRowKey={useCallback(getEntryKey, [])}\n        resetRowCustomFunction={useCallback(resetEntry, [])}\n      />\n    </div>\n  );\n};\n","/*\n * Copyright 2021 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport \"./LogicTypeSelector.css\";\nimport * as React from \"react\";\nimport { useCallback, useContext, useEffect, useMemo, useState } from \"react\";\nimport {\n  ContextProps,\n  DataType,\n  DecisionTableProps,\n  ExpressionProps,\n  InvocationProps,\n  ListProps,\n  LiteralExpressionProps,\n  LogicType,\n  RelationProps,\n} from \"../../api\";\nimport { LiteralExpression } from \"../LiteralExpression\";\nimport { RelationExpression } from \"../RelationExpression\";\nimport { ContextExpression } from \"../ContextExpression\";\nimport { useBoxedExpressionEditorI18n } from \"../../i18n\";\nimport { PopoverMenu } from \"../PopoverMenu\";\nimport { Button, ButtonVariant, Menu, MenuItem, MenuList } from \"@patternfly/react-core\";\nimport * as _ from \"lodash\";\nimport { useContextMenuHandler } from \"../../hooks\";\nimport { NO_TABLE_CONTEXT_MENU_CLASS } from \"../Table\";\nimport nextId from \"react-id-generator\";\nimport { BoxedExpressionGlobalContext } from \"../../context\";\nimport { DecisionTableExpression } from \"../DecisionTableExpression\";\nimport { ListExpression } from \"../ListExpression\";\nimport { InvocationExpression } from \"../InvocationExpression\";\n\nexport interface LogicTypeSelectorProps {\n  /** Expression properties */\n  selectedExpression: ExpressionProps;\n  /** Function to be invoked when logic type changes */\n  onLogicTypeUpdating: (logicType: LogicType) => void;\n  /** Function to be invoked when logic type is reset */\n  onLogicTypeResetting: () => void;\n  /** Function to be invoked to update expression's name and datatype */\n  onUpdatingNameAndDataType?: (updatedName: string, updatedDataType: DataType) => void;\n  /** Function to be invoked to retrieve the DOM reference to be used for selector placement */\n  getPlacementRef: () => HTMLDivElement;\n  /** True to have no header for this specific expression component, used in a recursive expression */\n  isHeadless?: boolean;\n  /** When a component is headless, it will call this function to pass its most updated expression definition */\n  onUpdatingRecursiveExpression?: (expression: ExpressionProps) => void;\n}\n\nexport const LogicTypeSelector: React.FunctionComponent<LogicTypeSelectorProps> = ({\n  selectedExpression,\n  onLogicTypeUpdating,\n  onLogicTypeResetting,\n  onUpdatingNameAndDataType,\n  getPlacementRef,\n  isHeadless = false,\n  onUpdatingRecursiveExpression,\n}) => {\n  const { i18n } = useBoxedExpressionEditorI18n();\n\n  const globalContext = useContext(BoxedExpressionGlobalContext);\n\n  const expression = _.extend(selectedExpression, {\n    uid: selectedExpression.uid || nextId(),\n    isHeadless,\n    onUpdatingNameAndDataType,\n    onUpdatingRecursiveExpression,\n  });\n\n  const isLogicTypeSelected = (logicType?: LogicType) => !_.isEmpty(logicType) && logicType !== LogicType.Undefined;\n\n  const [logicTypeSelected, setLogicTypeSelected] = useState(isLogicTypeSelected(expression.logicType));\n  const [bla, setBla] = useState({ opacity: 1 });\n\n  useEffect(() => {\n    setLogicTypeSelected(isLogicTypeSelected(selectedExpression.logicType));\n  }, [selectedExpression.logicType]);\n\n  const {\n    contextMenuRef,\n    contextMenuXPos,\n    contextMenuYPos,\n    contextMenuVisibility,\n    setContextMenuVisibility,\n  } = useContextMenuHandler();\n\n  const renderExpression = useMemo(() => {\n    switch (expression.logicType) {\n      case LogicType.LiteralExpression:\n        return <LiteralExpression {...(expression as LiteralExpressionProps)} />;\n      case LogicType.Relation:\n        return <RelationExpression {...(expression as RelationProps)} />;\n      case LogicType.Context:\n        return <ContextExpression {...(expression as ContextProps)} />;\n      case LogicType.DecisionTable:\n        return <DecisionTableExpression {...(expression as DecisionTableProps)} />;\n      case LogicType.Invocation:\n        return <InvocationExpression {...(expression as InvocationProps)} />;\n      case LogicType.List:\n        return <ListExpression {...(expression as ListProps)} />;\n      case LogicType.Function:\n      default:\n        return expression.logicType;\n    }\n    // logicType is enough for deciding when to re-execute this function\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [expression.logicType]);\n\n  const getLogicTypesWithoutUndefined = useCallback(\n    () => Object.values(LogicType).filter((logicType) => logicType !== LogicType.Undefined),\n    []\n  );\n\n  const renderLogicTypeItems = useCallback(\n    () =>\n      _.map(getLogicTypesWithoutUndefined(), (key) => (\n        <MenuItem key={key} itemId={key}>\n          {key}\n        </MenuItem>\n      )),\n    [getLogicTypesWithoutUndefined]\n  );\n\n  const getArrowPlacement = useCallback(() => getPlacementRef() as HTMLElement, [getPlacementRef]);\n\n  const getAppendToPlacement = useCallback(() => {\n    return globalContext.boxedExpressionEditorRef?.current ?? getArrowPlacement;\n  }, [getArrowPlacement, globalContext.boxedExpressionEditorRef]);\n\n  const onLogicTypeSelect = useCallback(\n    (event: MouseEvent, itemId: string) => {\n      setLogicTypeSelected(true);\n      const selectedLogicType = itemId as LogicType;\n      setBla({ opacity: 0 });\n      window.setTimeout(() => {\n        console.log(\">>>>>>>>>>>>>>>>>>>>>>>>>>>\");\n        setBla({ opacity: 1 });\n      }, 100);\n      onLogicTypeUpdating(selectedLogicType);\n    },\n    [onLogicTypeUpdating]\n  );\n\n  const buildLogicSelectorMenu = useCallback(\n    () => (\n      <PopoverMenu\n        title={i18n.selectLogicType}\n        arrowPlacement={getArrowPlacement}\n        appendTo={getAppendToPlacement()}\n        className=\"logic-type-popover\"\n        hasAutoWidth\n        body={\n          <Menu onSelect={onLogicTypeSelect}>\n            <MenuList>{renderLogicTypeItems()}</MenuList>\n          </Menu>\n        }\n      />\n    ),\n    [i18n.selectLogicType, getArrowPlacement, getAppendToPlacement, onLogicTypeSelect, renderLogicTypeItems]\n  );\n\n  const executeClearAction = useCallback(() => {\n    setLogicTypeSelected(false);\n    setContextMenuVisibility(false);\n    onLogicTypeResetting();\n  }, [onLogicTypeResetting, setContextMenuVisibility]);\n\n  const buildContextMenu = useCallback(\n    () => (\n      <div\n        className=\"context-menu-container no-table-context-menu\"\n        style={{\n          top: contextMenuYPos,\n          left: contextMenuXPos,\n        }}\n      >\n        <Button\n          isDisabled={!logicTypeSelected}\n          isSmall={true}\n          variant={ButtonVariant.primary}\n          onClick={executeClearAction}\n        >\n          {i18n.clear}\n        </Button>\n      </div>\n    ),\n    [logicTypeSelected, contextMenuXPos, contextMenuYPos, executeClearAction, i18n.clear]\n  );\n\n  return (\n    <div\n      style={bla}\n      className={`logic-type-selector ${NO_TABLE_CONTEXT_MENU_CLASS} ${\n        logicTypeSelected ? \"logic-type-selected\" : \"logic-type-not-present\"\n      }`}\n      ref={contextMenuRef}\n    >\n      {logicTypeSelected ? renderExpression : i18n.selectExpression}\n      {!logicTypeSelected ? buildLogicSelectorMenu() : null}\n      {contextMenuVisibility ? buildContextMenu() : null}\n    </div>\n  );\n};\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RefObject, useCallback, useEffect, useRef, useState } from \"react\";\n\nexport function useContextMenuHandler(): {\n  contextMenuRef: RefObject<HTMLDivElement>;\n  contextMenuXPos: string;\n  contextMenuYPos: string;\n  contextMenuVisibility: boolean;\n  setContextMenuVisibility: (value: ((prevState: boolean) => boolean) | boolean) => void;\n} {\n  const wrapperRef = useRef<HTMLDivElement>(null);\n\n  const [xPos, setXPos] = useState(\"0px\");\n  const [yPos, setYPos] = useState(\"0px\");\n  const [contextMenuVisible, setContextMenuVisible] = useState(false);\n\n  const hideContextMenu = useCallback(() => {\n    contextMenuVisible && setContextMenuVisible(false);\n  }, [contextMenuVisible]);\n\n  const showContextMenu = useCallback(\n    (event: MouseEvent) => {\n      if (wrapperRef.current && wrapperRef.current === event.target) {\n        event.preventDefault();\n        setXPos(`${event.pageX}px`);\n        setYPos(`${event.pageY}px`);\n        setContextMenuVisible(true);\n      }\n    },\n    [setXPos, setYPos]\n  );\n\n  useEffect(() => {\n    document.addEventListener(\"click\", hideContextMenu);\n    document.addEventListener(\"contextmenu\", hideContextMenu);\n    document.addEventListener(\"contextmenu\", showContextMenu);\n    return () => {\n      document.removeEventListener(\"click\", hideContextMenu);\n      document.removeEventListener(\"contextmenu\", hideContextMenu);\n      document.removeEventListener(\"contextmenu\", showContextMenu);\n    };\n  });\n\n  return {\n    contextMenuRef: wrapperRef,\n    contextMenuXPos: xPos,\n    contextMenuYPos: yPos,\n    contextMenuVisibility: contextMenuVisible,\n    setContextMenuVisibility: setContextMenuVisible,\n  };\n}\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as React from \"react\";\nimport { useCallback, useRef, useState } from \"react\";\nimport \"./ExpressionContainer.css\";\nimport { ExpressionProps, LogicType } from \"../../api\";\nimport { LogicTypeSelector } from \"../LogicTypeSelector\";\n\nexport interface ExpressionContainerProps {\n  /** Expression properties */\n  selectedExpression: ExpressionProps;\n}\n\nexport const ExpressionContainer: ({ selectedExpression }: ExpressionContainerProps) => JSX.Element = (\n  props: ExpressionContainerProps\n) => {\n  const expressionContainerRef = useRef<HTMLDivElement>(null);\n\n  const [selectedExpression, setSelectedExpression] = useState(props.selectedExpression);\n\n  const updateExpressionNameAndDataType = useCallback((updatedName, updatedDataType) => {\n    setSelectedExpression((previousSelectedExpression: ExpressionProps) => ({\n      ...previousSelectedExpression,\n      name: updatedName,\n      dataType: updatedDataType,\n    }));\n  }, []);\n\n  const onLogicTypeUpdating = useCallback((logicType) => {\n    setSelectedExpression((previousSelectedExpression: ExpressionProps) => ({\n      ...previousSelectedExpression,\n      logicType: logicType,\n    }));\n  }, []);\n\n  const onLogicTypeResetting = useCallback(() => {\n    setSelectedExpression((previousSelectedExpression: ExpressionProps) => {\n      const updatedExpression = {\n        uid: previousSelectedExpression.uid,\n        name: previousSelectedExpression.name,\n        dataType: previousSelectedExpression.dataType,\n        logicType: LogicType.Undefined,\n      };\n      window.beeApi?.resetExpressionDefinition?.(updatedExpression);\n      return updatedExpression;\n    });\n  }, []);\n\n  const getLogicTypeSelectorRef = useCallback(() => {\n    return expressionContainerRef.current!;\n  }, []);\n\n  return (\n    <div className=\"expression-container\">\n      <div className=\"expression-name-and-logic-type\">\n        <span className=\"expression-title\">{selectedExpression.name}</span>\n        <span className=\"expression-type\">({selectedExpression.logicType || LogicType.Undefined})</span>\n      </div>\n\n      <div\n        className=\"expression-container-box\"\n        ref={expressionContainerRef}\n        data-ouia-component-id=\"expression-container\"\n      >\n        <LogicTypeSelector\n          selectedExpression={selectedExpression}\n          onLogicTypeUpdating={onLogicTypeUpdating}\n          onLogicTypeResetting={onLogicTypeResetting}\n          onUpdatingNameAndDataType={updateExpressionNameAndDataType}\n          getPlacementRef={getLogicTypeSelectorRef}\n        />\n      </div>\n    </div>\n  );\n};\n","/*\n * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *        http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as React from \"react\";\nimport { useRef, useState } from \"react\";\nimport \"@patternfly/react-core/dist/styles/base-no-reset.css\";\nimport \"@patternfly/react-styles/css/components/Drawer/drawer.css\";\nimport \"./BoxedExpressionEditor.css\";\nimport { I18nDictionariesProvider } from \"@kogito-tooling/i18n/dist/react-components\";\nimport { ExpressionContainer, ExpressionContainerProps } from \"../ExpressionContainer\";\nimport {\n  boxedExpressionEditorDictionaries,\n  BoxedExpressionEditorI18nContext,\n  boxedExpressionEditorI18nDefaults,\n} from \"../../i18n\";\nimport { BoxedExpressionGlobalContext } from \"../../context\";\nimport * as _ from \"lodash\";\nimport { ResizerSupervisor } from \"../Resizer\";\n\nexport interface BoxedExpressionEditorProps {\n  /** All expression properties used to define it */\n  expressionDefinition: ExpressionContainerProps;\n}\n\nconst BoxedExpressionEditor: (props: BoxedExpressionEditorProps) => JSX.Element = (\n  props: BoxedExpressionEditorProps\n) => {\n  const [currentlyOpenedHandlerCallback, setCurrentlyOpenedHandlerCallback] = useState(() => _.identity);\n  const boxedExpressionEditorRef = useRef<HTMLDivElement>(null);\n\n  return (\n    <I18nDictionariesProvider\n      defaults={boxedExpressionEditorI18nDefaults}\n      dictionaries={boxedExpressionEditorDictionaries}\n      initialLocale={navigator.language}\n      ctx={BoxedExpressionEditorI18nContext}\n    >\n      <BoxedExpressionGlobalContext.Provider\n        value={{ boxedExpressionEditorRef, currentlyOpenedHandlerCallback, setCurrentlyOpenedHandlerCallback }}\n      >\n        <ResizerSupervisor>\n          <div className=\"boxed-expression-editor\" ref={boxedExpressionEditorRef}>\n            <ExpressionContainer {...props.expressionDefinition} />\n          </div>\n        </ResizerSupervisor>\n      </BoxedExpressionGlobalContext.Provider>\n    </I18nDictionariesProvider>\n  );\n};\n\nexport { BoxedExpressionEditor };\n"],"sourceRoot":""}